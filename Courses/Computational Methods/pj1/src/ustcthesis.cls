%
% Copyright (C) 2015-2022 by USTC TeX Users Group <https://github.com/ustctug>
%
% This file may be distributed and/or modified under the
% conditions of the LaTeX Project Public License, either version 1.3c
% of this license or (at your option) any later version.
% The latest version of this license is in
%    https://www.latex-project.org/lppl.txt
% and version 1.3c or later is part of all distributions of LaTeX
% version 2008 or later.
%

\NeedsTeXFormat{LaTeX2e}[2017/04/15]
\newcommand\ustcthesisversion{v3.3.1}
\ProvidesClass{ustcthesis}[2021/12/10 {\ustcthesisversion} USTC thesis template]

% æŠ¥é”™å’Œè­¦å‘Š
\newcommand\ustc@error[1]{%
  \ClassError{ustcthesis}{#1}{}%
}
\newcommand\ustc@warning[1]{%
  \ClassWarning{ustcthesis}{#1}%
}

% æ£€æŸ¥ \LaTeXe{} kernel ç‰ˆæœ¬
\@ifl@t@r\fmtversion{2017/04/15}{}{
  \ustc@error{%
    TeX Live 2017 or later version is required to compile this document%
  }
}

% æ£€æŸ¥ç¼–è¯‘å¼•æ“ï¼Œè¦æ±‚ä½¿ç”¨ XeLaTeX æˆ– LuaLaTeXã€‚
\RequirePackage{iftex}
\ifXeTeX\else
  \ifLuaTeX\else
    \ustc@error{XeLaTeX or LuaLaTeX is required to compile this document}
  \fi
\fi


% \subsection{å¤„ç†é€‰é¡¹}

\RequirePackage{kvdefinekeys}
\RequirePackage{kvsetkeys}
\RequirePackage{kvoptions}

% æä¾›ä¸€ä¸ª \cs{ustcsetup} å‘½ä»¤æ”¯æŒ \emph{key-value} çš„æ–¹å¼æ¥è®¾ç½®ã€‚
\let\ustc@setup@hook\@empty
\newcommand\ustcsetup[1]{%
  \let\ustc@setup@hook\@empty
  \kvsetkeys{ustc}{#1}%
  \ustc@setup@hook
}

% åŒæ—¶ç”¨ \emph{key-value} çš„æ–¹å¼æ¥å®šä¹‰è¿™äº›æ¥å£ï¼š
% \begin{latex}
%   \ustc@define@key{
%     <key> = {
%       name = <name>,
%       choices = {
%         <choice1>,
%         <choice2>,
%       },
%       default = <default>,
%       code = <code>,
%     },
%   }
% \end{latex}

% å…¶ä¸­ |choices| è®¾ç½®å…è®¸ä½¿ç”¨çš„å€¼ï¼Œé»˜è®¤ä¸ºç¬¬ä¸€ä¸ªï¼ˆæˆ–è€… \meta{default}ï¼‰ï¼›
% \meta{code} æ˜¯ç›¸åº”çš„å†…å®¹è¢«è®¾ç½®æ—¶æ‰§è¡Œçš„ä»£ç ã€‚

\newcommand\ustc@define@key[1]{%
  \kvsetkeys{ustc@key}{#1}%
}
\kv@set@family@handler{ustc@key}{%
%
% \cs{ustcsetup} ä¼šå°† \meta{value} å­˜åˆ° \cs{ustc@\meta{key}}ï¼Œ
% ä½†æ˜¯å®çš„åå­—åŒ…å« â€œ-â€ è¿™æ ·çš„ç‰¹æ®Šå­—ç¬¦æ—¶ä¸æ–¹ä¾¿ç›´æ¥è°ƒç”¨ï¼Œæ¯”å¦‚ |key = math-style|ï¼Œ
% è¿™æ—¶å¯ä»¥ç”¨ |name| è®¾ç½® \meta{key} çš„åˆ«ç§°ï¼Œæ¯”å¦‚ |key = math@style|ï¼Œ
% è¿™æ ·å°±å¯ä»¥é€šè¿‡ \cs{ustc@math@style} æ¥å¼•ç”¨ã€‚
% |default| æ˜¯å®šä¹‰è¯¥ \meta{key} æ—¶é»˜è®¤çš„å€¼ï¼Œç¼ºçœä¸ºç©ºã€‚
%
  \@namedef{ustc@#1@@name}{#1}%
  \def\ustc@@default{}%
  \def\ustc@@choices{}%
  \kv@define@key{ustc@value}{name}{%
    \@namedef{ustc@#1@@name}{##1}%
  }%
  %
  % ç”±äºåœ¨å®šä¹‰æ¥å£æ—¶ï¼Œ\cs{ustc@\meta{key}@@code} ä¸ä¸€å®šæœ‰å®šä¹‰ï¼Œ
  % è€Œä¸”åœ¨æ–‡æ¡£ç±»/å®åŒ…ä¸­è¿˜æœ‰å¯èƒ½å¯¹è¯¥ |key| çš„ |code| è¿›è¡Œæ·»åŠ ã€‚
  % æ‰€ä»¥ \cs{ustc@\meta{key}@@code} ä¼šæ£€æŸ¥å¦‚æœåœ¨å®šä¹‰æ–‡æ¡£ç±»/å®åŒ…æ—¶åˆ™æ¨è¿Ÿæ‰§è¡Œï¼Œå¦åˆ™ç«‹å³æ‰§è¡Œã€‚
  %
  \@namedef{ustc@#1@@check}{}%
  \@namedef{ustc@#1@@code}{}%
  %
  % ä¿å­˜ä¸‹ |choices = {}| å®šä¹‰çš„å†…å®¹ï¼Œåœ¨å®šä¹‰ \cs{ustc@\meta{name}} åå†æ‰§è¡Œã€‚
  %
  \kv@define@key{ustc@value}{choices}{%
    \def\ustc@@choices{##1}%
    \@namedef{ustc@#1@@reset}{}%
    %
    % \cs{ustc@\meta{key}@check} æ£€æŸ¥ |value| æ˜¯å¦æœ‰æ•ˆï¼Œ
    % å¹¶è®¾ç½® \cs{ifustc@\meta{name}@\meta{value}}ã€‚
    %
    \@namedef{ustc@#1@@check}{%
      \@ifundefined{%
        ifustc@\@nameuse{ustc@#1@@name}@\@nameuse{ustc@\@nameuse{ustc@#1@@name}}%
      }{%
        \ustc@error{Invalid value "#1 = \@nameuse{ustc@\@nameuse{ustc@#1@@name}}"}%
      }%
      \@nameuse{ustc@#1@@reset}%
      \@nameuse{ustc@\@nameuse{ustc@#1@@name}@\@nameuse{ustc@\@nameuse{ustc@#1@@name}}true}%
    }%
  }%
  \kv@define@key{ustc@value}{default}{%
    \def\ustc@@default{##1}%
  }%
  \kvsetkeys{ustc@value}{#2}%
  \@namedef{ustc@\@nameuse{ustc@#1@@name}}{}%
  %
  % ç¬¬ä¸€ä¸ª \meta{choice} è®¾ä¸º \meta{default}ï¼Œ
  % å¹¶ä¸”å¯¹æ¯ä¸ª \meta{choice} å®šä¹‰ \cs{ifustc@\meta{name}@\meta{choice}}ã€‚
  %
  \kv@set@family@handler{ustc@choice}{%
    \ifx\ustc@@default\@empty
      \def\ustc@@default{##1}%
    \fi
    \expandafter\newif\csname ifustc@\@nameuse{ustc@#1@@name}@##1\endcsname
    \expandafter\g@addto@macro\csname ustc@#1@@reset\endcsname{%
      \@nameuse{ustc@\@nameuse{ustc@#1@@name}@##1false}%
    }%
  }%
  \kvsetkeys@expandafter{ustc@choice}{\ustc@@choices}%
  %
  % å°† \meta{default} èµ‹å€¼åˆ° \cs{ustc@\meta{name}}ï¼Œå¦‚æœéç©ºåˆ™æ‰§è¡Œç›¸åº”çš„ä»£ç ã€‚
  %
  \expandafter\let\csname ustc@\@nameuse{ustc@#1@@name}\endcsname\ustc@@default
  \expandafter\ifx\csname ustc@\@nameuse{ustc@#1@@name}\endcsname\@empty\else
    \@nameuse{ustc@#1@@check}%
  \fi
  %
  % å®šä¹‰ \cs{ustcsetup} æ¥å£ã€‚
  %
  \kv@define@key{ustc}{#1}{%
    \@namedef{ustc@\@nameuse{ustc@#1@@name}}{##1}%
    \@nameuse{ustc@#1@@check}%
    \@nameuse{ustc@#1@@code}%
  }%
}

% å®šä¹‰æ¥å£å‘ |key| æ·»åŠ  |code|ï¼š

\newcommand\ustc@option@hook[2]{%
  \expandafter\g@addto@macro\csname ustc@#1@@code\endcsname{#2}%
}

\ustc@define@key{
  degree = {
    choices = {
      report,
      doctor,
      master,
      bachelor,
    },
    default = report,
  },
  degree-type = {
    name = degree@type,
    choices = {
      academic,
      professional,
    },
    default = academic,
  },
  main-language = {
    name = main@language,
    choices = {
      chinese,
      english,
    },
    default = chinese,
  },
  language = {
    choices = {
      chinese,
      english,
    },
    default = chinese,
  },
  system = {
    choices = {
      auto,
      mac,
      unix,
      windows,
    },
    default = auto,
  },
  fontset = {
    choices = {
      auto,
      windows,
      mac,
      ubuntu,
      fandol,
      none,
    },
    default = auto,
  },
  font = {
    choices = {
      auto,
      times,
      termes,
      stix,
      xits,
      libertinus,
      newcm,
      lm,
      newtx,
      none,
    },
    default = auto,
  },
  cjk-font = {
    name = cjk@font,
    choices = {
      auto,
      windows,
      mac,
      noto,
      fandol,
      none,
    },
    default = auto,
  },
  math-font = {
    name = math@font,
    choices = {
      auto,
      stix,
      xits,
      libertinus,
      newcm,
      cm,
      lm,
      newtx,
      none,
    },
    default = auto,
  },
  math-style = {
    name = math@style,
    choices = {
      GB,
      ISO,
      TeX,
    },
  },
  uppercase-greek = {
    name = uppercase@greek,
    choices = {
      italic,
      upright,
    },
  },
  less-than-or-equal = {
    name = leq,
    choices = {
      slanted,
      horizontal,
    },
  },
  integral = {
    choices = {
      upright,
      slanted,
    },
  },
  integral-limits = {
    name = integral@limits,
    choices = {
      true,
      false,
    },
  },
  partial = {
    choices = {
      upright,
      italic,
    },
  },
  math-ellipsis = {
    name = math@ellipsis,
    choices = {
      centered,
      lower,
      AMS,
    },
  },
  real-part = {
    name = real@part,
    choices = {
      roman,
      fraktur,
    },
  },
  cite-style = {
    name = cite@style,
    choices = {
      super,
      inline,
      authoryear,
    },
  },
  output = {
    choices = {
      print,
      electronic,
    },
    default = print,
  },
  section-style = {
    name = section@style,
    choices = {
      chinese,
      arabic,
    },
    default = chinese,
  },
  badge-color = {
    name = badge@color,
    choices = {
      blue,
      black,
    },
    default = blue,
  },
}

% å°† \ustc@cite@style ç½®ç©ºæ–¹ä¾¿åç»­è¿›è¡Œåˆ¤æ–­ã€‚
\def\ustc@cite@style{}

\newif\ifustc@degree@graduate
\newcommand\ustc@set@graduate{%
  \ifustc@degree@bachelor
    \ustc@degree@graduatefalse
  \else
    \ustc@degree@graduatetrue
  \fi
}
\ustc@set@graduate
\ustc@option@hook{degree}{%
  \ustc@set@graduate
}

% ä½¿ç”¨ \pkg{kvoptions} æä¾›çš„ key-value æ¥å£ï¼Œ
\SetupKeyvalOptions{
  family  = ustc,
  prefix  = ustc@,
  setkeys = \kvsetkeys,
}

% è®¾ç½®é»˜è®¤ \option{openany}ã€‚
\DeclareBoolOption[false]{openright}
\DeclareComplementaryOption{openany}{openright}

% å…¼å®¹æ—§ç‰ˆæœ¬çš„æ–‡æ¡£ç±»é€‰é¡¹ã€‚
% Reserved for compatibility until 2020-07-01.
\DeclareVoidOption{report}{\ustcsetup{degree=report}}
\DeclareVoidOption{doctor}{\ustcsetup{degree=doctor}}
\DeclareVoidOption{master}{\ustcsetup{degree=master}}
\DeclareVoidOption{bachelor}{\ustcsetup{degree=bachelor}}
\DeclareVoidOption{chinese}{\ustcsetup{language=chinese}}
\DeclareVoidOption{english}{\ustcsetup{language=english}}
\DeclareVoidOption{academic}{\ustcsetup{degree-type=academic}}
\DeclareVoidOption{professional}{\ustcsetup{degree-type=professional}}
\DeclareVoidOption{print}{\ustcsetup{output=print}}
\DeclareVoidOption{pdf}{\ustcsetup{output=electronic}}
\newif\ifustc@legacy@cite@style
\DeclareVoidOption{super}{\ustcsetup{cite-style=super}\ustc@legacy@cite@styletrue}
\DeclareVoidOption{numbers}{\ustcsetup{cite-style=inline}\ustc@legacy@cite@styletrue}
\DeclareVoidOption{authoryear}{\ustcsetup{cite-style=authoryear}\ustc@legacy@cite@styletrue}
\DeclareVoidOption{arabic}{\ustcsetup{section-style=arabic}}
\DeclareVoidOption{colorlogo}{\ustcsetup{badge-color=blue}}
\DeclareVoidOption{bwlogo}{\ustcsetup{badge-color=black}}

% è½½å…¥ \cls{ctexbook}ã€‚
\DeclareDefaultOption{\PassOptionsToClass{\CurrentOption}{ctexbook}}
\ProcessKeyvalOptions*


% \subsection{åŠ è½½æ–‡æ¡£ç±»å’Œå®åŒ…}

\ifustc@openright
  \PassOptionsToClass{openright}{book}
\else
  \PassOptionsToClass{openany}{book}
\fi

\ifustc@output@electronic
  \PassOptionsToClass{oneside}{book}
\fi
\PassOptionsToPackage{no-math}{fontspec}

% è½½å…¥ \cls{ctexbook} æ–‡æ¡£ç±»ï¼Œæ³¨æ„è¦æ±‚ä¸º 2.4.9 æˆ–æ›´é«˜çš„ç‰ˆæœ¬ã€‚
\LoadClass[UTF8,a4paper,scheme=plain,zihao=-4,fontset=none]{ctexbook}[2017/04/01]

% å»ºè®®åœ¨æ¨¡æ¿å¼€å§‹å¤„è½½å…¥å…¨éƒ¨å®åŒ…ï¼Œä¸è¦è½»æ˜“æ”¹å˜åŠ è½½é¡ºåºã€‚
% \pkg{hyperref} ä¸€èˆ¬åœ¨æœ€ååŠ è½½ã€‚
\RequirePackage{etoolbox}
\RequirePackage{amsmath}
\RequirePackage{fontspec}[2017/03/31]
\RequirePackage{geometry}
\RequirePackage{graphicx}
\RequirePackage{fancyhdr}
\RequirePackage{color}
\RequirePackage{titletoc}
\RequirePackage{caption}
\RequirePackage[perpage]{footmisc}
\RequirePackage{url}
\RequirePackage{notoccite}
\RequirePackage{multirow}

% å¦‚æœç”¨æˆ·åœ¨å¯¼è¨€åŒºæœªè°ƒç”¨ \pkg{biblatex}ï¼Œåˆ™è‡ªåŠ¨è°ƒç”¨ \pkg{natbib}ã€‚
\AtEndPreamble{
  \@ifpackageloaded{biblatex}{}{
    \RequirePackage{natbib}
  }
}

% å¯¹å†²çªçš„å®åŒ…æŠ¥é”™ã€‚
\RequirePackage{filehook}
\newcommand\ustc@package@conflict[2]{
  \AtEndOfPackageFile*{#1}{%
    \AtBeginOfPackageFile*{#2}{%
      \ustc@error{The "#2" package is incompatible with "#1"}%
    }%
  }%
}

\ustc@package@conflict{biblatex}{bibunits}
\ustc@package@conflict{biblatex}{chapterbib}
\ustc@package@conflict{biblatex}{cite}
\ustc@package@conflict{biblatex}{multibib}
\ustc@package@conflict{biblatex}{natbib}

\ustc@package@conflict{bibunits}{biblatex}
\ustc@package@conflict{bibunits}{chapterbib}
\ustc@package@conflict{bibunits}{multibib}

\ustc@package@conflict{unicode-math}{amscd}
\ustc@package@conflict{unicode-math}{amsfonts}
\ustc@package@conflict{unicode-math}{amssymb}
\ustc@package@conflict{unicode-math}{bbm}
\ustc@package@conflict{unicode-math}{bm}
\ustc@package@conflict{unicode-math}{eucal}
\ustc@package@conflict{unicode-math}{eufrak}
\ustc@package@conflict{unicode-math}{mathrsfs}
\ustc@package@conflict{unicode-math}{newtxmath}
\ustc@package@conflict{unicode-math}{upgreek}

\ustc@package@conflict{natbib}{biblatex}
\ustc@package@conflict{natbib}{cite}

\ustc@package@conflict{newtxmath}{amsfonts}
\ustc@package@conflict{newtxmath}{amssymb}
\ustc@package@conflict{newtxmath}{unicode-math}
\ustc@package@conflict{newtxmath}{upgreek}


% \pkg{amsthm} éœ€è¦åœ¨ \pkg{newtx} å‰è½½å…¥ï¼Œå‚è€ƒ \pkg{newtx} çš„æ–‡æ¡£ã€‚
\AtBeginOfPackageFile*{amsthm}{
  \@ifpackageloaded{newtxmath}{
    \ustc@error{The "amsthm" package should be loaded before setting "newtxmath"}
  }{}
}%



% \subsection{å¤„ç†è¯­è¨€}

% å®šä¹‰ \cs{ustc@main@language}ï¼Œå½“åœ¨å¯¼è¨€åŒºä¿®æ”¹ \option{language} æ—¶ï¼Œ
% ä¿å­˜ä¸ºè®ºæ–‡çš„ä¸»è¦è¯­è¨€ï¼›
% \cs{ustc@reset@main@language} åˆ™ç”¨äºæ­£æ–‡ä¸­æ¢å¤ä¸ºä¸»è¦è¯­è¨€ã€‚
%    \begin{macrocode}
\ustcsetup{main-language=\ustc@language}%
\let\ustc@main@language\ustc@language

\ustc@option@hook{language}{%
  \ifx\@begindocumenthook\@undefined\else
    \ustcsetup{main-language=\ustc@language}%
    \let\ustc@main@language\ustc@language
  \fi
}
\newcommand\ustc@reset@main@language{%
  \ustcsetup{language = \ustc@main@language}%
  \let\ustc@language\ustc@main@language
}

% å¸¦åœˆæ•°å­—å’Œæ˜Ÿå·ä½¿ç”¨ä¸­æ–‡å­—ä½“ã€‚
\ifLuaTeX
  % ctex å°†å¸¦åœˆæ•°å­— U+2460â€“U+24FF å½’å…¥å­—ç¬¦èŒƒå›´ 3ï¼ˆALcharï¼‰ï¼Œè¿™é‡Œæ”¹å›èŒƒå›´ 6ï¼ˆJAcharï¼‰
  \ltjdefcharrange{3}{%
    "2000-"243F, "2500-"27BF, "2900-"29FF, "2B00-"2BFF}
  \ltjdefcharrange{6}{%
    "2460-"24FF, "2E80-"2EFF, "3000-"30FF, "3190-"319F, "31F0-"4DBF,
    "4E00-"9FFF, "F900-"FAFF, "FE10-"FE1F, "FE30-"FE6F, "FF00-"FFEF,
    "1B000-"1B16F, "1F100-"1F2FF, "20000-"3FFFF, "E0100-"E01EF}
\else
  \ifXeTeX
    \xeCJKDeclareCharClass{CJK}{"2460 -> "2473}
    \xeCJKDeclareCharClass{CJK}{"2605}
  \fi
\fi

% ç”±äº Unicode çš„ä¸€äº›æ ‡ç‚¹ç¬¦å·æ˜¯ä¸­è¥¿æ–‡æ··ç”¨çš„ï¼š
% U+00B7ã€U+2013ã€U+2014ã€U+2018ã€U+2019ã€
% U+201Cã€U+201Dã€U+2025ã€U+2026ã€U+2E3Aï¼Œ
% æ‰€ä»¥è¦æ ¹æ®è¯­è¨€è®¾ç½®æ­£ç¡®çš„å­—ä½“ã€‚
% https://github.com/CTeX-org/ctex-kit/issues/389
\newcommand\ustc@set@punctuations{%
  \ifustc@language@chinese
    \ifLuaTeX
      \ltjsetparameter{jacharrange={+9}}
    \else
      \ifXeTeX
        \xeCJKDeclareCharClass{FullLeft}{"2018, "201C}%
        \xeCJKDeclareCharClass{FullRight}{
          "00B7, "2019, "201D, "2013, "2014, "2025, "2026, "2E3A,
        }%
      \fi
    \fi
  \else
    \ifLuaTeX
      \ltjsetparameter{jacharrange={-9}}
    \else
      \ifXeTeX
        \xeCJKDeclareCharClass{HalfLeft}{"2018, "201C}%
        \xeCJKDeclareCharClass{HalfRight}{
          "00B7, "2019, "201D, "2013, "2014, "2025, "2026, "2E3A,
        }%
      \fi
    \fi
  \fi
}
\ustc@set@punctuations
\ustc@option@hook{language}{\ustc@set@punctuations}

% æ ¹æ®è¯­è¨€è®¾ç½®å„ç« èŠ‚çš„åç§°ï¼Œåªæœ‰åœ¨å¯¼è¨€åŒºè®¾ç½® \option{language} æ—¶ä¼šä¿®æ”¹ï¼Œ
% è€Œåœ¨æ­£æ–‡å±€éƒ¨åˆ‡æ¢è¯­è¨€æ—¶åˆ™ä¸å˜ã€‚

% ç”±äºã€Šæ’°å†™æ‰‹å†Œã€‹ä¸­çš„â€œspecialityâ€ä¸€è¯ä½¿ç”¨çš„æ˜¯è‹±å¼æ‹¼æ³•ï¼Œ
% æ‰€ä»¥â€œacknowledgementsâ€ä¹Ÿä¿æŒä¸€è‡´ã€‚
\newcommand\ustc@set@chapter@names{%
  \ifustc@main@language@chinese
    \def\contentsname{ç›®å½•}%
    \def\listfigurename{æ’å›¾æ¸…å•}%
    \def\listtablename{è¡¨æ ¼æ¸…å•}%
    \ctexset{
      chapter/name   = {ç¬¬,ç« },
    }%
    \def\bibname{å‚è€ƒæ–‡çŒ®}%
    \def\appendixname{é™„å½•}%
    \def\ustc@acknowledgements@name{è‡´è°¢}%
    \def\ustc@publication@name{åœ¨è¯»æœŸé—´å‘è¡¨çš„å­¦æœ¯è®ºæ–‡ä¸å–å¾—çš„ç ”ç©¶æˆæœ}%
    \newcommand\ustc@notation@name{ç¬¦å·è¯´æ˜}%
  \else
    \def\contentsname{Contents}%
    \def\listfigurename{List of Figures}%
    \def\listtablename{List of Tables}%
    \ctexset{
      chapter/name   = {\chaptername\space},
    }%
    \def\bibname{Bibliography}%
    \def\appendixname{Appendix}%
    \def\ustc@acknowledgements@name{Acknowledgements}%
    \def\ustc@publication@name{Publications}%
    \def\ustc@notation@name{Notation}%
  \fi
}
\ustc@set@chapter@names
\ustc@option@hook{main-language}{\ustc@set@chapter@names}

% è¿™éƒ¨åˆ†åç§°åœ¨æ­£æ–‡ä¸­å±€éƒ¨åœ°ä¿®æ”¹è¯­è¨€æ—¶ä¼šå‘ç”Ÿå˜åŒ–ã€‚
\newcommand\ustc@set@names{%
  \ifustc@language@chinese
    \def\figurename{å›¾}%
    \def\tablename{è¡¨}%
  \else
    \def\figurename{Figure}%
    \def\tablename{Table}%
  \fi
}
\ustc@set@names
\ustc@option@hook{language}{\ustc@set@names}


% \subsection{å­—ä½“}

% å­—å·

% æ­£æ–‡å­—å·12bpï¼Œç ”ç©¶ç”Ÿè¡Œè·20bpï¼Œæœ¬ç§‘ç”Ÿè¡Œè·22bpï¼›
% å…¶ä»–å‘½ä»¤çš„è¡Œè·æŒ‰ç…§ç›¸åŒçš„çš„æ¯”ä¾‹è®¾ç½®ï¼Œå¦‚è¡¨~\ref{tab:fontsize}ã€‚
% \begin{table}[htb]
%   \centering
%   \caption{æ ‡å‡†å­—ä½“å‘½ä»¤ä¸å­—å·ã€è¡Œè·çš„å¯¹åº”}
%   \label{tab:fontsize}
%   \begin{tabular}{lllll}
%     \toprule
%     å­—ä½“å‘½ä»¤          & å­—å· & bp   & ç ”ç©¶ç”Ÿè¡Œè· & æœ¬ç§‘ç”Ÿè¡Œè· \\
%     \midrule
%     \cs{tiny}         & å°å…­ & 6.5  & 10.83      & 11.92      \\
%     \cs{scriptsize}   & å…­å· & 7.5  & 12.5       & 13.75      \\
%     \cs{footnotesize} & å°äº” & 9    & 15         & 16.5       \\
%     \cs{small}        & äº”å· & 10.5 & 17.5       & 19.25      \\
%     \cs{normalsize}   & å°å›› & 12   & 20         & 22         \\
%     \cs{large}        & å°ä¸‰ & 15   & 25         & 27.5       \\
%     \cs{Large}        & å°äºŒ & 18   & 30         & 33         \\
%     \cs{LARGE}        & äºŒå· & 22   & 36.67      & 40.33      \\
%     \cs{huge}         & å°ä¸€ & 24   & 40         & 44         \\
%     \cs{Huge}         & ä¸€å· & 26   & 43.33      & 47.67      \\
%     \bottomrule
%   \end{tabular}
% \end{table}
%
% æ³¨æ„é‡å®šä¹‰ \normalsize åº”åœ¨ \pkg{unicode-math} çš„ \cs{setmathfont} å‰ã€‚
\newcommand\ustc@set@font@size{%
  \ifustc@degree@graduate
    \renewcommand\normalsize{%
      \@setfontsize\normalsize{12bp}{20bp}%
      \abovedisplayskip 12bp \@plus3bp \@minus7bp%
      \abovedisplayshortskip \z@ \@plus3bp%
      \belowdisplayshortskip 6.5bp \@plus3.5bp \@minus3bp%
      \belowdisplayskip \abovedisplayskip
      \let\@listi\@listI}%
    %
    % æ³¨æ„ç¬¬~\ref{sec:list} èŠ‚å»æ‰äº†åˆ—è¡¨çš„é—´è·ï¼Œæ‰€ä»¥ä¸å†ä¿®æ”¹ \cs{@listi}ã€‚
  \else
    \renewcommand\normalsize{%
      \@setfontsize\normalsize{12bp}{22bp}%
      \abovedisplayskip 12bp \@plus3bp \@minus7bp%
      \abovedisplayshortskip \z@ \@plus3bp%
      \belowdisplayshortskip 6.5bp \@plus3.5bp \@minus3bp%
      \belowdisplayskip \abovedisplayskip
      \let\@listi\@listI}%
  \fi
  \normalsize
  \ifx\MakeRobust\@undefined \else
      \MakeRobust\normalsize
  \fi
}
\ustc@set@font@size
\ustc@option@hook{degree}{\ustc@set@font@size}

% è®¾ç½®è¡Œè·çš„å€æ•°ä¸º 1ã€‚
\linespread{1}\selectfont


% æ£€æµ‹ç³»ç»Ÿ
\ifustc@system@auto
  \IfFileExists{/System/Library/Fonts/Menlo.ttc}{
    \ustcsetup{system = mac}
  }{
    \IfFileExists{/dev/null}{
      \IfFileExists{null:}{
        \ustcsetup{system = windows}
      }{
        \ustcsetup{system = unix}
      }
    }{
      \ustcsetup{system = windows}
    }
  }
\fi

% å¤„ç† \opt{fontset}
\ifustc@fontset@auto
  \ifustc@system@windows
    \ustcsetup{fontset = windows}
  \else
    \ifustc@system@mac
      \ustcsetup{fontset = mac}
    \else
      \IfFontExistsTF{Noto Serif CJK SC}{
        \ustcsetup{fontset = ubuntu}
      }{
        \ustcsetup{fontset = fandol}
      }
    \fi
  \fi
\fi

% ã€Šæ’°å†™æ‰‹å†Œã€‹è¦æ±‚è¥¿æ–‡å­—ä½“ä½¿ç”¨ Times New Roman å’Œ Arialï¼Œ
% ä½†æ˜¯åœ¨ Linux ä¸‹æ²¡æœ‰è¿™ä¸¤ä¸ªå­—ä½“ï¼Œæ‰€ä»¥ä½¿ç”¨å®ƒä»¬çš„å…‹éš†ç‰ˆ TeX Gyre Termes å’Œ
% TeX Gyre Herosã€‚
\ifustc@font@auto
  \ifustc@fontset@windows
    \ustcsetup{font=times}
  \else
    \ifustc@fontset@mac
      \ustcsetup{font=times}
    \else
      \ustcsetup{font=termes}
    \fi
  \fi
\fi

% Times New Roman + Arial
\newcommand\ustc@set@font@times{%
  \setmainfont{Times New Roman}%
  \setsansfont{Arial}%
  \ifustc@system@mac
    \setmonofont{Menlo}[Scale = MatchLowercase]%
  \else
    \setmonofont{Courier New}[Scale = MatchLowercase]%
  \fi
}

% TeX Gyre Termes
\newcommand\ustc@set@font@termes{%
  \setmainfont{texgyretermes}[
    Extension      = .otf,
    UprightFont    = *-regular,
    BoldFont       = *-bold,
    ItalicFont     = *-italic,
    BoldItalicFont = *-bolditalic,
  ]%
  \ustc@set@texgyre@sans@mono
}

\newcommand\ustc@set@texgyre@sans@mono{%
  \setsansfont{texgyreheros}[
    Extension      = .otf,
    UprightFont    = *-regular,
    BoldFont       = *-bold,
    ItalicFont     = *-italic,
    BoldItalicFont = *-bolditalic,
  ]%
  \setmonofont{texgyrecursor}[
    Extension      = .otf,
    UprightFont    = *-regular,
    BoldFont       = *-bold,
    ItalicFont     = *-italic,
    BoldItalicFont = *-bolditalic,
    Scale          = MatchLowercase,
    Ligatures      = CommonOff,
  ]%
}

% STIX Two å­—ä½“ã€‚
% STIX æ–‡ä»¶ååœ¨ v2.10 2020-12-19 ä»
% \file{STIX2Text-Regular.otf}ã€\file{STIX2Math.otf} åˆ†åˆ«æ”¹ä¸º
% \file{STIXTwoText-Regular.otf}ã€\file{STIXTwoMath-Regular.otf}ã€‚
\let\ustc@font@family@stix\@empty
\newcommand\ustc@set@stix@names{%
  \ifx\ustc@font@family@stix\@empty
    \IfFontExistsTF{STIXTwoText-Regular.otf}{%
      \gdef\ustc@font@family@stix{STIXTwoText}%
      \gdef\ustc@font@name@stix@math{STIXTwoMath-Regular}%
    }{%
      \gdef\ustc@font@family@stix{STIX2Text}%
      \gdef\ustc@font@name@stix@math{STIX2Math}%
    }%
  \fi
}

\newcommand\ustc@set@font@stix{%
  \ustc@set@stix@names
  \setmainfont{\ustc@font@family@stix}[
    Extension      = .otf,
    UprightFont    = *-Regular,
    BoldFont       = *-Bold,
    ItalicFont     = *-Italic,
    BoldItalicFont = *-BoldItalic,
  ]%
  \ustc@set@texgyre@sans@mono
}

% XITS å­—ä½“ã€‚
% XITS çš„æ–‡ä»¶ååœ¨ v1.109 2018-09-30
% ä» \file{xits-regular.otf}ã€\file{xits-math.otf} åˆ†åˆ«æ”¹ä¸º
% \file{XITS-Regular.otf}ã€\file{XITSMath-Regular.otf}ã€‚
\let\ustc@font@family@xits\@empty
\newcommand\ustc@set@xits@names{%
  \ifx\ustc@font@family@xits\@empty
    \IfFontExistsTF{XITSMath-Regular.otf}{%
      \gdef\ustc@font@family@xits{XITS}%
      \gdef\ustc@font@style@xits@rm{Regular}%
      \gdef\ustc@font@style@xits@bf{Bold}%
      \gdef\ustc@font@style@xits@it{Italic}%
      \gdef\ustc@font@style@xits@bfit{BoldItalic}%
      \gdef\ustc@font@name@xits@math{XITSMath-Regular}%
    }{%
      \gdef\ustc@font@family@xits{xits}%
      \gdef\ustc@font@style@xits@rm{regular}%
      \gdef\ustc@font@style@xits@bf{bold}%
      \gdef\ustc@font@style@xits@it{italic}%
      \gdef\ustc@font@style@xits@bfit{bolditalic}%
      \gdef\ustc@font@name@xits@math{xits-math}%
    }%
  \fi
}

\newcommand\ustc@set@font@xits{%
  \ustc@set@xits@names
  \setmainfont{\ustc@font@family@xits}[
    Extension      = .otf,
    UprightFont    = *-\ustc@font@style@xits@rm,
    BoldFont       = *-\ustc@font@style@xits@bf,
    ItalicFont     = *-\ustc@font@style@xits@it,
    BoldItalicFont = *-\ustc@font@style@xits@bfit,
  ]%
  \ustc@set@texgyre@sans@mono
}

% Libertinus çš„æ–‡ä»¶ååœ¨ v6.7 2019-04-03 ä»å°å†™æ”¹ä¸ºé©¼å³°å¼ï¼Œ
% åœ¨å¤§å°å†™æ•æ„Ÿçš„å¹³å°ä¸Šéœ€è¦è¿›è¡Œåˆ¤æ–­ã€‚
\let\ustc@font@family@libertinus\@empty
\newcommand\ustc@set@libertinus@names{%
  \ifx\ustc@font@family@libertinus\@empty
    \IfFontExistsTF{LibertinusSerif-Regular.otf}{%
      \gdef\ustc@font@family@libertinus@serif{LibertinusSerif}%
      \gdef\ustc@font@family@libertinus@sans{LibertinusSans}%
      \gdef\ustc@font@name@libertinus@math{LibertinusMath-Regular}%
      \gdef\ustc@font@style@libertinus@rm{Regular}%
      \gdef\ustc@font@style@libertinus@bf{Bold}%
      \gdef\ustc@font@style@libertinus@it{Italic}%
      \gdef\ustc@font@style@libertinus@bfit{BoldItalic}%
    }{%
      \gdef\ustc@font@family@libertinus@serif{libertinusserif}%
      \gdef\ustc@font@family@libertinus@sans{libertinussans}%
      \gdef\ustc@font@name@libertinus@math{libertinusmath-regular}%
      \gdef\ustc@font@style@libertinus@rm{regular}%
      \gdef\ustc@font@style@libertinus@bf{bold}%
      \gdef\ustc@font@style@libertinus@it{italic}%
      \gdef\ustc@font@style@libertinus@bfit{bolditalic}%
    }%
  \fi
}

\newcommand\ustc@set@font@libertinus{%
  \ustc@set@libertinus@names
  \setmainfont{\ustc@font@family@libertinus@serif}[
    Extension      = .otf,
    UprightFont    = *-\ustc@font@style@libertinus@rm,
    BoldFont       = *-\ustc@font@style@libertinus@bf,
    ItalicFont     = *-\ustc@font@style@libertinus@it,
    BoldItalicFont = *-\ustc@font@style@libertinus@bfit,
  ]%
  \setsansfont{\ustc@font@family@libertinus@sans}[
    Extension      = .otf,
    UprightFont    = *-\ustc@font@style@libertinus@rm,
    BoldFont       = *-\ustc@font@style@libertinus@bf,
    ItalicFont     = *-\ustc@font@style@libertinus@it,
  ]%
  \setmonofont{lmmonolt10}[
    Extension      = .otf,
    UprightFont    = *-regular,
    BoldFont       = *-bold,
    ItalicFont     = *-oblique,
    BoldItalicFont = *-boldoblique,
  ]%
}

% New Computer Modern
\newcommand\ustc@set@font@newcm{%
  \setmainfont{NewCM10}[
    Extension      = .otf,
    UprightFont    = *-Book,
    BoldFont       = *-Bold,
    ItalicFont     = *-BookItalic,
    BoldItalicFont = *-BoldItalic,
  ]%
  \setsansfont{NewCMSans10}[
    Extension         = .otf,
    UprightFont       = *-Book,
    BoldFont          = *-Bold,
    ItalicFont        = *-BookOblique,
    BoldItalicFont    = *-BoldOblique,
  ]%
  \setmonofont{NewCMMono10}[
    Extension           = .otf,
    UprightFont         = *-Book,
    ItalicFont          = *-BookItalic,
    BoldFont            = *-Bold,
    BoldItalicFont      = *-BoldOblique,
  ]%
}

% Latin Modern
\newcommand\ustc@set@font@lm{%
  \setmainfont{lmroman10}[
    Extension      = .otf,
    UprightFont    = *-regular,
    BoldFont       = *-bold,
    ItalicFont     = *-italic,
    BoldItalicFont = *-bolditalic,
  ]%
  \setsansfont{lmsans10}[
    Extension      = .otf,
    UprightFont    = *-regular,
    BoldFont       = *-bold,
    ItalicFont     = *-oblique,
    BoldItalicFont = *-boldoblique,
  ]%
  \setmonofont{lmmonolt10}[
    Extension      = .otf,
    UprightFont    = *-regular,
    BoldFont       = *-bold,
    ItalicFont     = *-oblique,
    BoldItalicFont = *-boldoblique,
  ]%
}

\newcommand\ustc@set@font@newtx{%
  \RequirePackage{newtxtext}%
}

\newcommand\ustc@set@font{%
  \@nameuse{ustc@set@font@\ustc@font}%
}
\ustc@set@font
\ustc@option@hook{font}{\ustc@set@font}

% ä¸­æ–‡å­—ä½“
\ifustc@cjk@font@auto
  \ifustc@fontset@mac
    \ustcsetup{cjk-font = mac}
  \else
    \ifustc@fontset@windows
      \ustcsetup{cjk-font = windows}
    \else
      \ifustc@fontset@ubuntu
        \ustcsetup{cjk-font = noto}
      \else
        \ustcsetup{cjk-font = fandol}
      \fi
    \fi
  \fi
\fi

% Windows çš„ä¸­æ˜“å­—ä½“ã€‚
\newcommand\ustc@set@cjk@font@windows{%
  \setCJKmainfont{SimSun}[
    AutoFakeBold = 2,
    ItalicFont   = KaiTi,
  ]%
  \setCJKsansfont{SimHei}[AutoFakeBold = 2]%
  \setCJKmonofont{FangSong}%
  \setCJKfamilyfont{zhsong}{SimSun}[AutoFakeBold = 2]%
  \setCJKfamilyfont{zhhei}{SimHei}[AutoFakeBold = 2]%
  \setCJKfamilyfont{zhkai}{KaiTi}%
  \setCJKfamilyfont{zhfs}{FangSong}%
}

% macOS çš„åæ–‡å­—ä½“ã€‚
\newcommand\ustc@set@cjk@font@mac{%
  \defaultCJKfontfeatures{}%
  \setCJKmainfont{Songti SC}[
    UprightFont    = * Light,
    BoldFont       = * Bold,
    ItalicFont     = Kaiti SC Regular,
    BoldItalicFont = Kaiti SC Bold,
  ]%
  \setCJKsansfont{Heiti SC}[
    UprightFont    = * Light,
    BoldFont       = * Medium,
  ]%
  \setCJKmonofont{STFangsong}
  \setCJKfamilyfont{zhsong}{Songti SC}[
    UprightFont    = * Light,
    BoldFont       = * Bold,
  ]%
  \setCJKfamilyfont{zhhei}{Heiti SC}[
    UprightFont    = * Light,
    BoldFont       = * Medium,
  ]%
  \setCJKfamilyfont{zhfs}{STFangsong}%
  \setCJKfamilyfont{zhkai}{Kaiti SC}[
    UprightFont    = * Regular,
    BoldFont       = * Bold,
  ]%
  \setCJKfamilyfont{zhli}{Baoli SC}%
  \setCJKfamilyfont{zhyuan}{Yuanyi SC}[
    UprightFont    = * Light,
    BoldFont       = * Bold,
  ]%
}

% æ€æºå­—ä½“ã€‚
% æ³¨æ„ Noto CJK çš„ regular å­—é‡åå­—ä¸å¸¦â€œRegularâ€ã€‚
\newcommand\ustc@set@cjk@font@noto{%
  \defaultCJKfontfeatures{}%
  \setCJKmainfont{Noto Serif CJK SC}[
    UprightFont    = * Light,
    BoldFont       = * Bold,
    ItalicFont     = FandolKai-Regular,
    ItalicFeatures = {Extension = .otf},
    Script         = CJK,
  ]%
  \setCJKsansfont{Noto Sans CJK SC}[
    BoldFont       = * Medium,
    Script         = CJK,
  ]%
  \setCJKmonofont{Noto Sans Mono CJK SC}[
    Script         = CJK,
  ]%
  \setCJKfamilyfont{zhsong}{Noto Serif CJK SC}[
    UprightFont    = * Light,
    UprightFont    = * Bold,
    Script         = CJK,
  ]%
  \setCJKfamilyfont{zhhei}{Noto Sans CJK SC}[
    BoldFont       = * Medium,
    Script         = CJK,
  ]%
  \setCJKfamilyfont{zhfs}{FandolFang}[
    Extension      = .otf,
    UprightFont    = *-Regular,
  ]%
  \setCJKfamilyfont{zhkai}{FandolKai}[
    Extension      = .otf,
    UprightFont    = *-Regular,
  ]%
}

% Fandol å­—ä½“ã€‚
\newcommand\ustc@set@cjk@font@fandol{%
  \defaultCJKfontfeatures{}%
  \setCJKmainfont{FandolSong}[
    Extension   = .otf,
    UprightFont = *-Regular,
    BoldFont    = *-Bold,
    ItalicFont  = FandolKai-Regular,
    ItalicFeatures = {Extension = .otf},
  ]%
  \setCJKsansfont{FandolHei}[
    Extension   = .otf,
    UprightFont = *-Regular,
    BoldFont    = *-Bold,
  ]%
  \setCJKmonofont{FandolFang}[
    Extension   = .otf,
    UprightFont = *-Regular,
  ]%
  \setCJKfamilyfont{zhsong}{FandolSong}[
    Extension   = .otf,
    UprightFont = *-Regular,
    BoldFont    = *-Bold,
  ]%
  \setCJKfamilyfont{zhhei}{FandolHei}[
    Extension   = .otf,
    UprightFont = *-Regular,
    BoldFont    = *-Bold,
  ]%
  \setCJKfamilyfont{zhfs}{FandolFang}[
    Extension   = .otf,
    UprightFont = *-Regular,
  ]%
  \setCJKfamilyfont{zhkai}{FandolKai}[
    Extension   = .otf,
    UprightFont = *-Regular,
  ]%
}

\ifustc@cjk@font@none\else
  \providecommand\songti{\CJKfamily{zhsong}}
  \providecommand\heiti{\CJKfamily{zhhei}}
  \providecommand\fangsong{\CJKfamily{zhfs}}
  \providecommand\kaishu{\CJKfamily{zhkai}}
\fi

\newcommand\ustc@set@cjk@font{%
  \@nameuse{ustc@set@cjk@font@\ustc@cjk@font}%
}
\ustc@set@cjk@font
\ustc@option@hook{cjk-font}{\ustc@set@cjk@font}

% æ•°å­¦å­—ä½“

% è®¾ç½®æ•°å­¦ç¬¦å·é£æ ¼ã€‚
\newcommand\ustc@set@math@style{%
  \ifustc@math@style@TeX
    \ustcsetup{
      uppercase-greek    = upright,
      less-than-or-equal = horizontal,
      integral           = slanted,
      integral-limits    = false,
      partial            = italic,
      math-ellipsis      = AMS,
      real-part          = fraktur,
    }%
  \else
    \ustcsetup{
      uppercase-greek = italic,
      integral        = upright,
      integral-limits = true,
      partial         = upright,
      real-part       = roman,
    }%
    \ifustc@math@style@ISO
      \ustcsetup{
        less-than-or-equal = horizontal,
        math-ellipsis      = lower,
      }%
    \else
      \ifustc@math@style@GB
        \ustcsetup{
          less-than-or-equal = slanted,
          math-ellipsis      = centered,
        }%
      \fi
    \fi
  \fi
}

\ifustc@main@language@chinese
  \ustcsetup{math-style = GB}%
\else
  \ustcsetup{math-style = TeX}%
\fi

\ustc@set@math@style
\ustc@option@hook{math-style}{\ustc@set@math@style}
\ustc@option@hook{main-language}{%
  \ifustc@main@language@chinese
    \ustcsetup{math-style = GB}%
  \else
    \ustcsetup{math-style = TeX}%
  \fi
}

% é’ˆå¯¹ \pkg{unicode-math} é€é¡¹é…ç½®æ•°å­¦ç¬¦å·ã€‚

\newcommand\ustc@set@unimath@leq{%
  \ifustc@leq@horizontal
    \ifx\@begindocumenthook\@undefined
      \let\le\ustc@save@leq
      \let\ge\ustc@save@geq
      \let\leq\ustc@save@leq
      \let\geq\ustc@save@geq
    \else
      \AtBeginDocument{%
        \let\le\ustc@save@leq
        \let\ge\ustc@save@geq
        \let\leq\ustc@save@leq
        \let\geq\ustc@save@geq
      }%
    \fi
  \else
    \ifustc@leq@slanted
      \ifx\@begindocumenthook\@undefined
        \let\le\leqslant
        \let\ge\geqslant
        \let\leq\leqslant
        \let\geq\geqslant
      \else
        \AtBeginDocument{%
          \let\le\leqslant
          \let\ge\geqslant
          \let\leq\leqslant
          \let\geq\geqslant
        }%
      \fi
    \fi
  \fi
}
\newcommand\ustc@set@unimath@integral@limits{%
  \ifustc@integral@limits@true
    \removenolimits{%
      \int\iint\iiint\iiiint\oint\oiint\oiiint
      \intclockwise\varointclockwise\ointctrclockwise\sumint
      \intbar\intBar\fint\cirfnint\awint\rppolint
      \scpolint\npolint\pointint\sqint\intlarhk\intx
      \intcap\intcup\upint\lowint
    }%
  \else
    \addnolimits{%
      \int\iint\iiint\iiiint\oint\oiint\oiiint
      \intclockwise\varointclockwise\ointctrclockwise\sumint
      \intbar\intBar\fint\cirfnint\awint\rppolint
      \scpolint\npolint\pointint\sqint\intlarhk\intx
      \intcap\intcup\upint\lowint
    }%
  \fi
}
\newcommand\ustc@set@unimath@ellipsis{%
  \ifustc@math@ellipsis@centered
    \DeclareRobustCommand\mathellipsis{\mathinner{\unicodecdots}}%
  \else
    \DeclareRobustCommand\mathellipsis{\mathinner{\unicodeellipsis}}%
  \fi
}
\newcommand\ustc@set@unimath@real@part{%
  \ifustc@real@part@roman
    \AtBeginDocument{%
      \def\Re{\operatorname{Re}}%
      \def\Im{\operatorname{Im}}%
    }%
  \else
    \AtBeginDocument{%
      \let\Re\ustc@save@Re
      \let\Im\ustc@save@Im
    }%
  \fi
}

\newcommand\ustc@set@unimath@style{%
  \ifustc@uppercase@greek@upright
    \unimathsetup{math-style = TeX}%
  \else
    \ifustc@uppercase@greek@italic
      \unimathsetup{math-style = ISO}%
    \fi
  \fi
  \ifustc@math@style@TeX
    \unimathsetup{bold-style = TeX}%
  \else
    \unimathsetup{bold-style = ISO}%
  \fi
  \ustc@set@unimath@leq
  \ustc@set@unimath@integral@limits
  \ifustc@partial@upright
    \unimathsetup{partial = upright}%
  \else
    \ifustc@partial@italic
      \unimathsetup{partial = italic}%
    \fi
  \fi
  \ustc@set@unimath@ellipsis
  \ustc@set@unimath@real@part
}

\newcommand\ustc@qed{\rule{1ex}{1ex}}
\newcommand\ustc@load@unimath{%
  \@ifpackageloaded{unicode-math}{}{%
    \RequirePackage{unicode-math}%
    \AtBeginDocument{%
      \let\ustc@save@leq\leq
      \let\ustc@save@geq\geq
      \let\ustc@save@Re\Re
      \let\ustc@save@Im\Im
    }%
    %
    % å…¼å®¹æ—§çš„ç²—ä½“å‘½ä»¤ï¼š\pkg{bm} çš„ \cs{bm} å’Œ \pkg{amsmath} çš„ \cs{boldsymbol}ã€‚
    \DeclareRobustCommand\bm[1]{{\symbfit{##1}}}%
    \DeclareRobustCommand\boldsymbol[1]{{\symbfit{##1}}}%
    %
    % å…¼å®¹ \pkg{amsfonts} å’Œ \pkg{amssymb} ä¸­çš„ä¸€äº›å‘½ä»¤ã€‚
    \newcommand\square{\mdlgwhtsquare}%
    \newcommand\blacksquare{\mdlgblksquare}%
    \AtBeginDocument{%
      \renewcommand\checkmark{\ensuremath{âœ“}}%
    }%
    %
    % å…¼å®¹ \pkg{amsthm} çš„ \cs{qedsymbol}ã€‚
    \renewcommand\ustc@qed{\ensuremath{\QED}}%
  }%
}

% STIX Two Math
\newcommand\ustc@set@math@font@stix{%
  \ustc@load@unimath
  \ustc@set@unimath@style
  \ustc@set@stix@names
  \setmathfont{\ustc@font@name@stix@math}[
    Extension    = .otf,
    Scale        = MatchLowercase,
    StylisticSet = \ustc@xits@integral@stylistic@set,
  ]%
  \setmathfont{\ustc@font@name@stix@math}[
    Extension    = .otf,
    Scale        = MatchLowercase,
    StylisticSet = 1,
    range        = {scr,bfscr},
  ]%
}

% XITS Math
\newcommand\ustc@xits@integral@stylistic@set{%
  \ifustc@integral@upright
    8%
  \fi
}
\newcommand\ustc@set@math@font@xits{%
  \ustc@load@unimath
  \ustc@set@unimath@style
  \ustc@set@xits@names
  \setmathfont{\ustc@font@name@xits@math}[
    Extension    = .otf,
    StylisticSet = \ustc@xits@integral@stylistic@set,
  ]%
  \setmathfont{\ustc@font@name@xits@math}[
    Extension    = .otf,
    StylisticSet = 1,
    range        = {cal,bfcal},
  ]%
}

% Libertinus Math
\newcommand\ustc@libertinus@integral@stylistic@set{%
  \ifustc@integral@slanted
    8%
  \fi
}
\newcommand\ustc@set@math@font@libertinus{%
  \ustc@load@unimath
  \ustc@set@unimath@style
  \ustc@set@libertinus@names
  \ustc@set@xits@names
  \setmathfont{\ustc@font@name@libertinus@math}[
    Extension    = .otf,
    StylisticSet = \ustc@libertinus@integral@stylistic@set,
  ]%
  \setmathfont{\ustc@font@name@xits@math}[
    Extension    = .otf,
    range        = {\checkmark},
  ]%
}

% New Computer Modern Math
\newcommand\ustc@newcm@integral@stylistic@set{%
  \ifustc@integral@upright
    2%
  \fi
}
\newcommand\ustc@set@math@font@newcm{%
  \ustc@load@unimath
  \ustc@set@unimath@style
  \setmathfont{NewCMMath-Book}[
    Extension    = .otf,
    StylisticSet = \ustc@newcm@integral@stylistic@set,
  ]%
  \setmathfont{NewCMMath-Book}[
    Extension    = .otf,
    StylisticSet = 1,
    range        = {scr,bfscr},
  ]%
  \setmathrm{NewCM10}[
    Extension      = .otf,
    UprightFont    = *-Book,
    BoldFont       = *-Bold,
    ItalicFont     = *-BookItalic,
    BoldItalicFont = *-BoldItalic,
  ]%
  \setmathsf{NewCMSans10}[
    Extension         = .otf,
    UprightFont       = *-Book,
    BoldFont          = *-Bold,
    ItalicFont        = *-BookOblique,
    BoldItalicFont    = *-BoldOblique,
  ]%
  \setmathtt{NewCMMono10}[
    Extension           = .otf,
    UprightFont         = *-Book,
    ItalicFont          = *-BookItalic,
    BoldFont            = *-Bold,
    BoldItalicFont      = *-BoldOblique,
  ]%
}

% Latin Modern Math
\newcommand\ustc@set@math@font@lm{%
  \ustc@load@unimath
  \ustc@set@unimath@style
  \setmathfont{latinmodern-math}[Extension=.otf]%
  \setmathrm{lmroman10}[
    Extension      = .otf,
    UprightFont    = *-regular,
    BoldFont       = *-bold,
    ItalicFont     = *-italic,
    BoldItalicFont = *-bolditalic,
  ]%
  \setmathsf{lmsans10}[
    Extension      = .otf,
    UprightFont    = *-regular,
    BoldFont       = *-bold,
    ItalicFont     = *-oblique,
    BoldItalicFont = *-boldoblique,
  ]%
  \setmathtt{lmmonolt10}[
    Extension      = .otf,
    UprightFont    = *-regular,
    BoldFont       = *-bold,
    ItalicFont     = *-oblique,
    BoldItalicFont = *-boldoblique,
  ]%
}

% NewTX Math
% æ³¨æ„ NewTX Math æ˜¯ Type 1 å­—ä½“ï¼Œå¦‚æœæ­£æ–‡è¥¿æ–‡ä½¿ç”¨äº† OpenType å­—ä½“æ—¶éœ€è¦å°å¿ƒå¤„ç†ã€‚
\newcommand\ustc@set@math@font@newtx{%
  \ifustc@font@newtx\else
    \let\ustc@save@encodingdefault\encodingdefault
    \let\ustc@save@rmdefault\rmdefault
    \let\ustc@save@sfdefault\sfdefault
    \let\ustc@save@ttdefault\ttdefault
    \RequirePackage[T1]{fontenc}%
    \renewcommand{\rmdefault}{ntxtlf}%
    \renewcommand{\sfdefault}{qhv}%
    \renewcommand{\ttdefault}{ntxtt}%
  \fi
  \ifustc@uppercase@greek@italic
    \PassOptionsToPackage{slantedGreek}{newtxmath}%
  \fi
  \ifustc@integral@upright
    \PassOptionsToPackage{upint}{newtxmath}%
  \fi
  \RequirePackage{newtxmath}
  \let\ustc@save@leq\leq
  \let\ustc@save@geq\geq
  \ifustc@leq@slanted
    \let\le\leqslant
    \let\ge\geqslant
    \let\leq\leqslant
    \let\geq\geqslant
  \fi
  \ifustc@integral@limits@true
    \let\ilimits@\displaylimits
  \fi
  \let\ustc@save@partial\partial
  \ifustc@partial@upright
    \let\partial\uppartial
  \fi
  \ifustc@math@ellipsis@centered
    \DeclareRobustCommand\mathellipsis{\mathinner{\cdotp\cdotp\cdotp}}%
  \else
    \DeclareRobustCommand\mathellipsis{\mathinner{\ldotp\ldotp\ldotp}}%
  \fi
  \let\ustc@save@Re\Re
  \let\ustc@save@Im\Im
  \ifustc@real@part@roman
    \def\Re{\operatorname{Re}}%
    \def\Im{\operatorname{Im}}%
  \fi
  \RequirePackage{bm}%
  \ifustc@font@newtx\else
    \let\encodingdefault\ustc@save@encodingdefault
    \let\rmdefault\ustc@save@rmdefault
    \let\sfdefault\ustc@save@sfdefault
    \let\ttdefault\ustc@save@ttdefault
  \fi
  \DeclareRobustCommand\symup[1]{{\mathrm{##1}}}%
  \DeclareRobustCommand\symbf[1]{{\bm{##1}}}%
  \DeclareRobustCommand\symbfsf[1]{{\bm{##1}}}%
  \let\increment\upDelta%
  \renewcommand\ustc@qed{\openbox}%
}

% Computer Modern
% ä½¿ç”¨ LaTeX é»˜è®¤çš„ cm å­—ä½“
\newcommand\ustc@set@math@font@cm{%
  \RequirePackage{amssymb}
  \let\ustc@save@leq\leq
  \let\ustc@save@geq\geq
  \ifustc@leq@slanted
    \let\le\leqslant
    \let\ge\geqslant
    \let\leq\leqslant
    \let\geq\geqslant
  \fi
  \ifustc@integral@limits@true
    \let\ilimits@\displaylimits
  \fi
  \ifustc@math@ellipsis@centered
    \DeclareRobustCommand\mathellipsis{\mathinner{\cdotp\cdotp\cdotp}}%
  \else
    \DeclareRobustCommand\mathellipsis{\mathinner{\ldotp\ldotp\ldotp}}%
  \fi
  \let\ustc@save@Re\Re
  \let\ustc@save@Im\Im
  \ifustc@real@part@roman
    \def\Re{\operatorname{Re}}%
    \def\Im{\operatorname{Im}}%
  \fi
  \RequirePackage{bm}%
  \DeclareRobustCommand\symup[1]{{\mathrm{##1}}}%
  \DeclareRobustCommand\symbf[1]{{\bm{##1}}}%
  \DeclareRobustCommand\symbfsf[1]{{\bm{##1}}}%
  \let\increment\Delta
  \renewcommand\ustc@qed{\openbox}%
  \let\uppi\pi
}

% ä¸è®¾ç½®æ•°å­¦å­—ä½“ï¼Œä»…æä¾›å…¼å®¹æ”¯æŒã€‚
\newcommand\ustc@set@math@font@none{%
  \RequirePackage{amssymb}
  \RequirePackage{bm}%
  \DeclareRobustCommand\symup[1]{{\mathrm{##1}}}%
  \DeclareRobustCommand\symbf[1]{{\bm{##1}}}%
  \DeclareRobustCommand\symbfsf[1]{{\bm{##1}}}%
  \let\increment\Delta
  \renewcommand\ustc@qed{\openbox}%
  \let\uppi\pi
}

\newcommand\ustc@set@math@font{%
  \@nameuse{ustc@set@math@font@\ustc@math@font}%
}
\ustc@option@hook{math-font}{\g@addto@macro\ustc@setup@hook{\ustc@set@math@font}}
\newcommand\ustc@set@math@font@auto{%
  \ifustc@math@font@auto
    \ustcsetup{math-font=xits}%
  \fi
}
\AtBeginOfPackageFile*{siunitx}{\ustc@set@math@font@auto}
\AtEndPreamble{%
  \ustc@set@math@font@auto
  \ifx\square\@undefined
    \RequirePackage{amssymb}%
  \fi
}



% \subsection{çº¸å¼ å’Œé¡µé¢}
% ä½¿ç”¨ \pkg{geometry} å®åŒ…è®¾ç½®çº¸å¼ å’Œé¡µé¢ã€‚

% çº¸å¼ ï¼šA4ï¼›

% é¡µé¢è®¾ç½®ï¼šä¸Šã€ä¸‹ 2.54 cmï¼Œå·¦ã€å³ 3.17 cmï¼Œé¡µçœ‰ 1.5 cmï¼Œé¡µè„š 1.75 cmã€‚

% æ³¨æ„è¿™é‡ŒæŒ‡çš„æ˜¯é¡µçœ‰é¡¶éƒ¨åˆ°çº¸å¼ é¡¶éƒ¨çš„è·ç¦»ä¸º 1.5 cmï¼Œ
% æ‰€ä»¥åº”è¯¥æ˜¯ 2.54cm - 0.8cm - 0.24cm = 1.5cm

\geometry{
  paper      = a4paper,
  vmargin    = 2.54cm,
  hmargin    = 3.17cm,
  headheight = 0.75cm,
  headsep    = 0.29cm,
  footskip   = 0.79cm,
}

% ä½¿ç”¨ \pkg{fancy} éœ€è¦å…ˆè°ƒç”¨ |\pagestyle{fancy}| å†ä¿®æ”¹ \cs{chaptermark} å’Œ
% \cs{sectionmark}ã€‚
\pagestyle{fancy}
\let\sectionmark\@gobble
\renewcommand\headrulewidth{0.4\p@}

% é‡å®šä¹‰é»˜è®¤çš„ |plain| page styleï¼Œä¼šæ˜¾ç¤ºé¡µçœ‰å’Œé¡µè„šã€‚
\fancypagestyle{plain}{%
  \fancyhf{}%
  %
  % é¡µçœ‰ä¸è¯¥éƒ¨åˆ†çš„ç« æ ‡é¢˜ç›¸åŒï¼Œå®‹ä½“ 10.5 ç£…ï¼ˆäº”å·ï¼‰å±…ä¸­ã€‚
  % é¡µç ï¼šå®‹ä½“ 10.5 ç£…ã€é¡µé¢ä¸‹è„šå±…ä¸­ã€‚
  \ifustc@degree@graduate
    \def\ustc@hf@font{\fontsize{10.5bp}{12bp}\selectfont}
    
    \ifustc@degree@report
      % ğŸ¥µï¼Œ
      \fancyhead[C]{
        \ustc@hf@font 
        \ifx\@\ustc@course\@empty\else
          \ustc@courseâ€”
        \fi
          å®éªŒæŠ¥å‘Š
      }%
    \else
      \fancyhead[C]{\ustc@hf@font\leftmark}%
    \fi
    \fancyfoot[C]{\ustc@hf@font\thepage}%
    \let\@mkboth\markboth
    \def\chaptermark##1{%
      \markboth{\CTEXifname{\CTEXthechapter\quad}{}\ustc@spacetitle{##1}}{}%
    }%
    \let\sectionmark\@gobble
  \else
    %
    % æœ¬ç§‘ç”Ÿè¦æ±‚é™¤å°é¢ã€æ‰‰é¡µå¤–ï¼Œæ¯é¢ä¸Šéƒ¨åŠ é¡µçœ‰ï¼Œ
    % ç”¨å° 5 å·å­—ï¼ˆ9 bpï¼‰æ ‡æ³¨â€œä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦æœ¬ç§‘æ¯•ä¸šè®ºæ–‡â€ï¼Œå±…ä¸­ï¼›
    % ä»ç›®å½•é¡µå¼€å§‹åœ¨æ¯é¢åº•éƒ¨å±…ä¸­ç”¨å°äº”å®‹ä½“ï¼ˆ9 bpï¼‰è¿ç»­ç¼–é¡µç ã€‚
    \def\ustc@hf@font{\fontsize{9bp}{12bp}\selectfont}
    \fancyhead[C]{\ustc@hf@font ä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦æœ¬ç§‘æ¯•ä¸šè®ºæ–‡}
    \fancyfoot[C]{\ustc@hf@font\thepage}%
    \let\@mkboth\@gobbletwo
    \let\chaptermark\@gobble
    \let\sectionmark\@gobble
  \fi
}
\pagestyle{plain}

% |headings| åªæœ‰é¡µçœ‰ï¼Œæ²¡æœ‰é¡µè„šï¼Œç”¨äºç ”ç©¶ç”Ÿçš„ç¬¦å·è¯´æ˜å’Œæœ¬ç§‘ç”Ÿçš„ front matterã€‚
\fancypagestyle{headings}{\fancyfoot{}}

% è®¾ç½®ç‰¹æ®Šçš„ page style ä¸æ”¹å˜ä»»ä½•å†…å®¹ï¼Œç”¨äºæ¯ç« é¦–é¡µã€‚
\def\ps@chapter{}
\ctexset{chapter/pagestyle=chapter}

% ç©ºç™½é¡µä¸åŠ é¡µçœ‰å’Œé¡µç ã€‚
\def\cleardoublepage{%
  \clearpage
  \if@twoside
    \ifodd\c@page\else
      \hbox{}%
      \ifustc@degree@graduate
        \thispagestyle{empty}%
      \fi
      \newpage
      \if@twocolumn
        \hbox{}%
        \newpage
      \fi
    \fi
  \fi
}

%
% ç ”ç©¶ç”Ÿè¦æ±‚ä»â€œä¸­æ–‡æ‘˜è¦â€å¼€å§‹é¡µç ç”¨å¤§å†™ç½—é©¬æ•°å­—ï¼Œ
% è€Œæœ¬ç§‘ç”Ÿçš„ frontmatterï¼ˆåªæœ‰è‡´è°¢ï¼‰ä¸ç¼–é¡µç ï¼Œä»ç›®å½•å¼€å§‹é¡µç ç”¨é˜¿æ‹‰ä¼¯æ•°å­—ã€‚
\renewcommand\frontmatter{%
  \cleardoublepage
  \@mainmatterfalse
  \pagenumbering{Roman}%
  \ifustc@degree@graduate
    \pagestyle{plain}%
  \else
    \pagestyle{headings}%
  \fi
}

% ç ”ç©¶ç”Ÿè¦æ±‚â€œç¬¬ 1 ç« â€è¦å¦é¡µèµ·ï¼Œä½†æ˜¯æœ¬ç§‘ç”Ÿè¦æ±‚å¦é¢èµ·ã€‚
\renewcommand\mainmatter{%
  \cleardoublepage
  \ifustc@degree@graduate
    \pagenumbering{arabic}%
  \fi
  \pagestyle{plain}%
  \@mainmattertrue
}

\g@addto@macro\appendix{\@mainmattertrue}%


% \subsection{å°é¢}


% å®šä¹‰ç”¨æˆ·æ¥å£ï¼š
\ustc@define@key{
  course = {
    default = {},
  },
  course* = {
    default = {},
    name    = course@en,
  },
  title = {
    default = {è®ºæ–‡é¢˜ç›®},
  },
  title* = {
    default = {Title},
    name    = title@en,
  },
  author = {
    default = {ä½œè€…å§“å},
  },
  author* = {
    default = {Author Name},
    name    = author@en,
  },
  speciality = {
    default = {ä¸“ä¸š},
  },
  speciality* = {
    default = {Speciality},
    name    = speciality@en,
  },
  supervisor = {
    default = {å¯¼å¸ˆå§“å},
  },
  supervisor* = {
    default = {Supervisor Name},
    name    = supervisor@en,
  },
  advisor = {
    default = {},
  },
  advisor* = {
    default = {},
    name    = advisor@en,
  },
  date = {
    default = {\the\year-\two@digits{\month}-\two@digits{\day}},
  },
  professional-type = {
    name = professional@type,
  },
  professional-type* = {
    name = professional@type@en,
  },
  department,
  student-id = {
    name = student@id,
  },
  secret-level = {
    name    = secret@level,
  },
  secret-level* = {
    name    = secret@level@en,
  },
  secret-year = {
    name    = secret@year,
  },
  keywords,
  keywords* = {
    name    = keywords@en,
  },
}

% å¯¼å¸ˆä¸€æ å¯èƒ½æœ‰å¤šä¸ªå§“åï¼Œæ‰€ä»¥ç”¨ \opt{supervisor} è¿›è¡Œæ”¶é›†ï¼Œ
% ç„¶åä½¿ç”¨æœ¬å‘½ä»¤æ¥è¾“å‡ºè¦æ±‚çš„æ ¼å¼ï¼Œ
% ç±»ä¼¼äº \LaTeX3 çš„ \cs{clist\_use:Nn}ã€‚
\newcommand\ustc@clist@count[1]{%
  \csname clist_count:N\endcsname{#1}%
}
\newcommand\ustc@clist@use[2]{%
  \csname clist_use:Nn\endcsname{#1}{#2}%
}
\newcommand\ustc@supervisor@names{%
  \ustc@clist@use{\ustc@supervisor}{\quad}
}
\newcommand\ustc@advisor@names{%
  \ustc@clist@use{\ustc@advisor}{\quad}
}
\newcounter{ustc@count}
\newcommand\ustc@supervisor@en@line{%
  \setcounter{ustc@count}{\ustc@clist@count{\ustc@supervisor@en}}%
  \ifnum\c@ustc@count>1\relax
    Supervisors:%
  \else
    Supervisor:%
  \fi
  \space\ustc@clist@use{\ustc@supervisor@en}{, }%
}
\newcommand\ustc@advisor@en@line{%
  \setcounter{ustc@count}{\ustc@clist@count{\ustc@advisor@en}}%
  \ifnum\c@ustc@count>1\relax
    Advisor:%
  \else
    Advisor:%
  \fi
  \space\ustc@clist@use{\ustc@advisor@en}{, }%
}

% è¾“å‡ºæ—¥æœŸçš„ç»™å®šæ ¼å¼ï¼š\cs{ustc@format@date}\marg{format}\marg{date}ï¼Œ
% å…¶ä¸­æ ¼å¼ \meta{format} æ¥å—ä¸‰ä¸ªå‚æ•°åˆ†åˆ«å¯¹åº”å¹´ã€æœˆã€æ—¥ï¼Œ
% \meta{date} æ˜¯ ISO æ ¼å¼çš„æ—¥æœŸï¼ˆyyyy-mm-ddï¼‰ã€‚
\newcommand\ustc@format@date[2]{%
  \edef\ustc@@date{#2}%
  \def\ustc@@process@date##1-##2-##3\@nil{%
    #1{##1}{##2}{##3}%
  }%
  \expandafter\ustc@@process@date\ustc@@date\@nil
}
\newcommand\ustc@date@format@zh@small[3]{\number#1 å¹´ \number#2 æœˆ \number#3 æ—¥}
\newcommand\ustc@date@format@zh@big[3]{\zhdigits{#1}å¹´\zhnumber{#2}æœˆ\zhnumber{#3}æ—¥}
\newcommand\ustc@date@month[1]{%
  \ifcase\number#1\or
    January\or February\or March\or April\or May\or June\or
    July\or August\or September\or October\or November\or December%
  \fi
}
\newcommand\ustc@date@format@en[3]{\ustc@date@month{#2} \number#3, #1}
\newcommand\ustc@date@zh@small{\ustc@format@date{\ustc@date@format@zh@small}{\ustc@date}}
\newcommand\ustc@date@zh@big{\ustc@format@date{\ustc@date@format@zh@big}{\ustc@date}}
\newcommand\ustc@date@en{\ustc@format@date{\ustc@date@format@en}{\ustc@date}}

% ç‰ˆæœ¬ v3.2 å¼€å§‹ä½¿ç”¨ \cs{ustcsetup} è®¾ç½®æ¥å£ï¼Œ
% å…¼å®¹æ—§ç‰ˆæœ¬çš„å‘½ä»¤å¼è®¾ç½®ã€‚
% Reserved for compatibility until 2020-07-01.
\def\ustc@define@term#1#2{%
  \expandafter\gdef\csname #1\endcsname##1{%
    \ustcsetup{#2 = {##1}}%
  }%
}
\ustc@define@term{title}{title}
\ustc@define@term{entitle}{title*}
\ustc@define@term{author}{author}
\ustc@define@term{enauthor}{author*}
\ustc@define@term{major}{speciality}
\ustc@define@term{enmajor}{speciality*}
\ustc@define@term{supervisor}{supervisor}
\ustc@define@term{ensupervisor}{supervisor*}
\gdef\cosupervisor#1{%
  \g@addto@macro\ustc@supervisor{, #1}%
}
\gdef\encosupervisor#1{%
  \g@addto@macro\ustc@supervisor@en{, #1}%
}
\gdef\date#1{\renewcommand\ustc@date@zh@big{#1}}
\gdef\endate#1{\renewcommand\ustc@date@en{#1}}
\ustc@define@term{professionaltype}{professional-type}
\ustc@define@term{enprofessionaltype}{professional-type*}
\ustc@define@term{secretlevel}{secret-level}
\ustc@define@term{ensecretlevel}{secret-level*}
\ustc@define@term{secretyear}{secret-year}
\gdef\keywords#1{\renewcommand\ustc@keywords@text{#1}}
\gdef\enkeywords#1{\renewcommand\ustc@keywords@en@text{#1}}

% å®šä¹‰ä¸€äº›å¸¸é‡ã€‚
\ifustc@degree@report
  \newcommand\ustc@thesis@name{å®éªŒæŠ¥å‘Š}
  \newcommand\ustc@thesis@name@en{A lab report}
\else
  \ifustc@degree@doctor
    \newcommand\ustc@thesis@name{åšå£«å­¦ä½è®ºæ–‡}
    \newcommand\ustc@thesis@name@en{A dissertation for doctor's degree}
  \else
    \ifustc@degree@master
      \newcommand\ustc@thesis@name{ç¡•å£«å­¦ä½è®ºæ–‡}
      \newcommand\ustc@thesis@name@en{A dissertation for master's degree}
    \else
      \newcommand\ustc@thesis@name{å­¦å£«å­¦ä½è®ºæ–‡}
      \newcommand\ustc@thesis@name@en{A dissertation for bachelor's degree}
    \fi
  \fi
\fi
\ifustc@degree@type@academic
  \newcommand\ustc@speciality@name{å­¦ç§‘ä¸“ä¸š}
\else
  \ifustc@degree@doctor
    \renewcommand\ustc@thesis@name{ä¸“ä¸šåšå£«å­¦ä½è®ºæ–‡}
  \else
    \renewcommand\ustc@thesis@name{ä¸“ä¸šç¡•å£«å­¦ä½è®ºæ–‡}
  \fi
  \ifustc@cjk@font@mac
    \providecommand\lishu{\CJKfamily{zhli}}
  \else
    \ifustc@cjk@font@windows
      \setCJKfamilyfont{zhli}{LiSu}
      \providecommand\lishu{\CJKfamily{zhli}}
    \else
      \ustc@warning{LiShu font is required}
      \providecommand\lishu{\sffamily}
    \fi
  \fi
  \newcommand\ustc@speciality@name{ä¸“ä¸šé¢†åŸŸ}
\fi

% å®šä¹‰æ ¡å¾½é¢œè‰²
%
% æ¨è¿Ÿå®šä¹‰é¢œè‰²ä»¥é¿å…è°ƒç”¨ \pkg{xcolor} æ—¶çš„è­¦å‘Š
\AtBeginDocument{
  \definecolor{ustcblue}{cmyk}{1,0.8,0,0}
}

% æ·»åŠ  PDF ä¹¦ç­¾ï¼Œåœ¨ \pkg{hyperref} è½½å…¥åæ‰æœ‰æ•ˆã€‚
\newcommand\ustc@pdfbookmark{\@gobble}

% é‡å®šä¹‰ \env{titlepage} ç¯å¢ƒï¼Œä¸ä¿®æ”¹é¡µç ã€‚
\renewenvironment{titlepage}{%
  \cleardoublepage
  \if@twocolumn
    \@restonecoltrue\onecolumn
  \else
    \@restonecolfalse\newpage
  \fi
  \thispagestyle{empty}%
}{%
  \if@restonecol\twocolumn \else \newpage \fi
}

% ä¸­æ–‡å°é¢ï¼š
% å¯†çº§ä»¿å®‹ 14 ç£…ï¼›
% è®ºæ–‡ç±»å‹é»‘ä½“ 56 ç£…ï¼›
% è®ºæ–‡é¢˜ç›®é»‘ä½“ 26 ç£…åŠ ç²—å±…ä¸­ï¼Œå•å€è¡Œè·ï¼›
% ä½œè€…å§“åå®‹ä½“ 16 ç£…ï¼Œå•å€è¡Œè·ï¼›
% æ³¨æ„è¿™é‡Œçš„â€œå•å€è¡Œè·â€çš„åœ°æ–¹å¼€å¯äº†â€œå¯¹é½åˆ°ç½‘æ ¼â€ï¼Œæ‰€ä»¥å®é™…è¡Œè·æœ‰æ‰€åå·®ï¼Œ
% æ‰€ä»¥åªèƒ½ä½¿ç”¨ç›´å°ºæµ‹é‡ã€‚
\newcommand\ustc@speciality@sse{è½¯ä»¶å·¥ç¨‹}
\newcommand\ustc@title@page@graduate@zh{%
  \ustcsetup{language=chinese}%
  \begin{titlepage}%
    \ustc@pdfbookmark{å°é¢}%
    \centering
    \parbox[t][0.6cm][t]{\textwidth}{%
      \raggedleft\fangsong\fontsize{14bp}{14bp}\selectfont
      \null\ustc@secret@level\par}\par
    \vskip 0.5cm%
    \includegraphics[height=1.3cm]{figures/ustc-name.pdf}\par
    \vskip 0.6cm%
    {\sffamily\fontsize{56bp}{56bp}\selectfont
      \ustc@thesis@name\par}%
    \ifustc@degree@type@academic
      \vskip 2.0cm%
    \else
      \vskip 0.8cm%
      \begingroup
        \fontsize{26bp}{26bp}\selectfont
        \ifx\ustc@professional@type\@empty
          \null
        \else
          \lishu ï¼ˆ\ustc@professional@type ï¼‰%
        \fi
        \par
      \endgroup
      \vskip 1.0cm%
    \fi
    \ifustc@badge@color@blue
      \textcolor{ustcblue}{%
        \includegraphics[height=4.1cm]{figures/ustc-badge.pdf}}%
    \else
      \includegraphics[height=4.1cm]{figures/ustc-badge.pdf}%
    \fi\par
    \vskip 0.9cm%
    \parbox[t][3.5cm][c]{\textwidth}{%
      \centering\sffamily\bfseries\fontsize{26bp}{50bp}\selectfont
      \ustc@title\par}\par
    \vskip 0.6cm%
    {\fontsize{16bp}{31bp}\selectfont
      \begin{tabular}{@{}l@{\hspace{\ccwd}}l@{}}%
        \textsf{ä½œè€…å§“åï¼š} & \ustc@author \\
        \textsf{\ustc@speciality@nameï¼š} & \ustc@speciality \\
        \ifx\ustc@advisor\@empty
          \textsf{å¯¼å¸ˆå§“åï¼š} & \ustc@supervisor@names \\
        \else
          \textsf{æ ¡å†…å¯¼å¸ˆï¼š} & \ustc@supervisor@names \\
          \textsf{ä¼ä¸šå¯¼å¸ˆï¼š} & \ustc@advisor@names \\
        \fi
        \textsf{å®Œæˆæ—¶é—´ï¼š} & \ustc@date@zh@big
      \end{tabular}\par}%
  \end{titlepage}%
  \ustc@reset@main@language
}

% è‹±æ–‡å°é¢
\newcommand\ustc@title@page@graduate@en{%
  \ustcsetup{language=english}%
  \begin{titlepage}%
    \ustc@pdfbookmark{Title page}%
    \centering
    \parbox[t][0.4cm][t]{\textwidth}{%
      \raggedleft\fontsize{14bp}{14bp}\selectfont
      \null\ustc@secret@level@en\par}\par
    \vskip 0.5cm%
    {\sffamily\fontsize{20bp}{30bp}\selectfont
      University of Science and Technology of China\par}%
    {\sffamily\fontsize{26bp}{30bp}\selectfont
      \ustc@thesis@name@en\par}%
    \ifustc@degree@type@academic\else
      \begingroup
        \fontsize{16bp}{32bp}\selectfont
        \ifx\ustc@professional@type@en\@empty
          \null
        \else
          (\ustc@professional@type@en)
        \fi
        \par
      \endgroup
    \fi
    \vskip 2.5cm%
    \ifustc@badge@color@blue
      \textcolor{ustcblue}{%
        \includegraphics[height=4.5cm]{figures/ustc-badge.pdf}}%
    \else
      \includegraphics[height=4.5cm]{figures/ustc-badge.pdf}%
    \fi\par
    \vskip 0.5cm%
    \parbox[t][4.5cm][c]{\textwidth}{%
      \centering\sffamily\bfseries\fontsize{26bp}{30bp}\selectfont
      \ustc@title@en\par}\par
    \vskip 1.6cm%
    {\fontsize{16bp}{30bp}\selectfont
      \begin{tabular}{@{}l@{}}%
        Author:        \ustc@author@en \\
        Speciality:    \ustc@speciality@en \\
        \ustc@supervisor@en@line \\
        \ifx\ustc@advisor\@empty
        \else
          \ustc@advisor@en@line \\
        \fi
        Finished time: \ustc@date@en
      \end{tabular}\par}%
  \end{titlepage}%
  \ustc@reset@main@language
}

% æœ¬ç§‘ç”Ÿçš„å°é¢
\newcommand\ustc@title@page@bachelor{%
  \begin{titlepage}%
    \ustc@pdfbookmark{Title page}%
    \centering
    \vspace*{0.8cm}%
    \includegraphics{figures/ustc-title-page-heading.pdf}%
    \vskip 4.3cm%
    \begingroup
      \bfseries\fontsize{15bp}{16bp}\selectfont
      \setlength\tabcolsep{\z@}%
      \setlength\arrayrulewidth{1.5pt}%
      \begin{tabular}{lp{140bp}lp{140bp}}
        é¢˜\quad ç›® &
          \multirow[t]{2}{325bp}{%
            \centering\fontsize{15bp}{40bp}\selectfont
            \ustc@title
          } & & \\
        \cline{2-4}
        \noalign{\vskip 24bp}
        & & & \\
        \cline{2-4}
        \noalign{\vskip 24bp}
        è‹±\quad æ–‡ &
          \multirow[t]{3}{325bp}{%
            \centering\fontsize{15bp}{40bp}\selectfont
            \ustc@title@en
          } & & \\
        \cline{2-4}
        \noalign{\vskip 24bp}
        é¢˜\quad ç›® & & & \\
        \cline{2-4}
        \noalign{\vskip 24bp}
        & & & \\
        \cline{2-4}
        \noalign{\vskip 24bp}
        é™¢\quad ç³» & \multirow[t]{1}{325bp}{\centering\ustc@department} & & \\
        \cline{2-4}
        \noalign{\vskip 24bp}
        å§“\quad å & \multirow[t]{1}{140bp}{\centering\ustc@author} &
        å­¦\quad å· & \multirow[t]{1}{140bp}{\centering\ustc@student@id} \\
        \cline{2-2}
        \cline{4-4}
        \noalign{\vskip 24bp}
        å¯¼\quad å¸ˆ & \multirow[t]{1}{325bp}{\centering\ustc@supervisor@names} & & \\
        \cline{2-4}
        \noalign{\vskip 24bp}
        æ—¥\quad æœŸ & \multirow[t]{1}{325bp}{\centering\ustc@date@zh@small} & & \\
        \cline{2-4}
      \end{tabular}
    \endgroup
  \end{titlepage}%
}

% ğŸ˜‡æŠ¥å‘Šå°é¢ï¼š
\newcommand\ustc@title@page@report{%
  \ustcsetup{language=chinese}%
  \begin{titlepage}%
    \ustc@pdfbookmark{å°é¢}%
    \centering
    \parbox[t][0.6cm][t]{\textwidth}{%
      \raggedleft\fangsong\fontsize{14bp}{14bp}\selectfont
      \null\ustc@secret@level\par}\par
    \vskip 0.5cm%
    \includegraphics[height=1.3cm]{figures/ustc-name.pdf}\par
    \vskip 0.6cm%
    {\sffamily\fontsize{56bp}{56bp}\selectfont
      \ustc@thesis@name\par}%
    \vskip 2.0cm%
    \ifustc@badge@color@blue
      \textcolor{ustcblue}{%
        \includegraphics[height=4.1cm]{figures/ustc-badge.pdf}}%
    \else
      \includegraphics[height=4.1cm]{figures/ustc-badge.pdf}%
    \fi\par
    \vskip 0.9cm%
    \parbox[t][3.5cm][c]{\textwidth}{%
      \centering\rmfamily\bfseries\fontsize{26bp}{50bp}\selectfont
      \ifx\ustc@course\@empty\else
        \ustc@course \\ 
      \fi
      \ustc@title\par}\par
    \vskip 0.6cm%
    {\fontsize{16bp}{31bp}\selectfont
      \begin{tabular}{@{}l@{\hspace{\ccwd}}l@{}}%
        % \textsf{å®éªŒé¢˜ç›®ï¼š} & \ustc@title \\
        \textsf{å­¦ç”Ÿå§“åï¼š} & \ustc@author \\
        \textsf{å­¦ç”Ÿå­¦å·ï¼š} & \ustc@student@id \\
        \ifx\ustc@supervisor\@empty\else
          \textsf{æˆè¯¾æ•™å¸ˆï¼š} & \ustc@supervisor@names \\
        \fi
        \ifx\ustc@advisor\@empty\else
          \textsf{è¯¾ç¨‹åŠ©æ•™} & \ustc@advisor@names \\
        \fi
        \textsf{å®Œæˆæ—¶é—´ï¼š} & \ustc@date@zh@big
      \end{tabular}\par}%
  \end{titlepage}%
  \ustc@reset@main@language
}

% é‡æ–°å®šä¹‰ \cs{maketitle}ï¼Œè°ƒç”¨ \cs{ustc@makezhtitle}, \cs{ustc@makeentitle}
% åˆ†åˆ«ç”Ÿæˆä¸­ã€è‹±æ–‡å°é¢ã€‚
\renewcommand\maketitle{%
  \newgeometry{margin=2.54cm}%
  \pagenumbering{Alph}%
  \pagestyle{empty}%
  \ifustc@degree@graduate
    \ifustc@degree@report
      \ustc@title@page@report
    \else
      \ustc@title@page@graduate@zh
      \ustc@title@page@graduate@en
    \fi
  \else
      \ustc@title@page@bachelor
  \fi
  \cleardoublepage
  \restoregeometry
  \pagestyle{plain}%
}


% \subsection{åŸåˆ›æ€§å£°æ˜}

% å®šä¹‰åŸåˆ›æ€§å£°æ˜
\newcommand\ustc@originality{%
  æœ¬äººå£°æ˜æ‰€å‘ˆäº¤çš„å­¦ä½è®ºæ–‡ï¼Œæ˜¯æœ¬äººåœ¨å¯¼å¸ˆæŒ‡å¯¼ä¸‹è¿›è¡Œç ”ç©¶å·¥ä½œæ‰€å–å¾—çš„æˆæœã€‚%
  é™¤å·²ç‰¹åˆ«åŠ ä»¥æ ‡æ³¨å’Œè‡´è°¢çš„åœ°æ–¹å¤–ï¼Œè®ºæ–‡ä¸­ä¸åŒ…å«ä»»ä½•ä»–äººå·²ç»å‘è¡¨æˆ–æ’°å†™è¿‡çš„%
  ç ”ç©¶æˆæœã€‚%
  ä¸æˆ‘ä¸€åŒå·¥ä½œçš„åŒå¿—å¯¹æœ¬ç ”ç©¶æ‰€åšçš„è´¡çŒ®å‡å·²åœ¨è®ºæ–‡ä¸­ä½œäº†æ˜ç¡®çš„è¯´æ˜ã€‚}
\newcommand\ustc@authorization{%
  ä½œä¸ºç”³è¯·å­¦ä½çš„æ¡ä»¶ä¹‹ä¸€ï¼Œå­¦ä½è®ºæ–‡è‘—ä½œæƒæ‹¥æœ‰è€…æˆæƒä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦æ‹¥æœ‰%
  å­¦ä½è®ºæ–‡çš„éƒ¨åˆ†ä½¿ç”¨æƒï¼Œ%
  å³ï¼šå­¦æ ¡æœ‰æƒæŒ‰æœ‰å…³è§„å®šå‘å›½å®¶æœ‰å…³éƒ¨é—¨æˆ–æœºæ„é€äº¤è®ºæ–‡çš„å¤å°ä»¶å’Œç”µå­ç‰ˆï¼Œ%
  å…è®¸è®ºæ–‡è¢«æŸ¥é˜…å’Œå€Ÿé˜…ï¼Œå¯ä»¥å°†å­¦ä½è®ºæ–‡ç¼–å…¥ã€Šä¸­å›½å­¦ä½è®ºæ–‡å…¨æ–‡æ•°æ®åº“ã€‹ç­‰%
  æœ‰å…³æ•°æ®åº“è¿›è¡Œæ£€ç´¢ï¼Œå¯ä»¥é‡‡ç”¨å½±å°ã€ç¼©å°æˆ–æ‰«æç­‰å¤åˆ¶æ‰‹æ®µä¿å­˜ã€æ±‡ç¼–å­¦ä½è®ºæ–‡ã€‚%
  æœ¬äººæäº¤çš„ç”µå­æ–‡æ¡£çš„å†…å®¹å’Œçº¸è´¨è®ºæ–‡çš„å†…å®¹ç›¸ä¸€è‡´ã€‚\par
  æ§é˜…çš„å­¦ä½è®ºæ–‡åœ¨è§£å¯†åä¹Ÿéµå®ˆæ­¤è§„å®šã€‚}
  %
  % ç”Ÿæˆç©ºçš„ä¸‹åˆ’çº¿
\newcommand\ustc@underline[2][3.2cm]{\underline{\hb@xt@ #1{\hss#2\hss}}}

\newcommand\ustc@checkbox{%
  \makebox[\z@][l]{$\square$}%
  \raisebox{-0.2ex}{\hspace{0.1em}$\checkmark$}%
}

\newcommand\copyrightpage{%
  \begin{titlepage}%
    \ustc@pdfbookmark{åŸåˆ›æ€§å’Œæˆæƒä½¿ç”¨å£°æ˜}%
    \null
    \vskip 0.3cm%
    {\centering\sffamily\fontsize{16bp}{32bp}\selectfont
      ä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦å­¦ä½è®ºæ–‡åŸåˆ›æ€§å£°æ˜\par}%
    \vskip 0.7cm%
    \ustc@originality\par
    \vskip 1.3cm%
    ä½œè€…ç­¾åï¼š\ustc@underline{}\hspace{2.7cm}%
    ç­¾å­—æ—¥æœŸï¼š\ustc@underline{}\par
    \vskip 1.9cm%
    {\centering\sffamily\fontsize{16bp}{32bp}\selectfont
      ä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦å­¦ä½è®ºæ–‡æˆæƒä½¿ç”¨å£°æ˜\par}%
    \vskip 0.7cm%
    \ustc@authorization\par
    \vskip 0.6cm%
    \ifx\ustc@secret@level\@empty
      \ustc@checkbox{} å…¬å¼€\quad
      $\square$ æ§é˜…ï¼ˆ\ustc@underline[0.85cm]{}å¹´ï¼‰\par
    \else
      $\square$ å…¬å¼€\quad
      \ustc@checkbox{} æ§é˜…ï¼ˆ\ustc@underline[0.8cm]{\ustc@secret@year}å¹´ï¼‰\par
    \fi
    \vskip 0.5cm%
    ä½œè€…ç­¾åï¼š\ustc@underline{}\hspace{2.7cm}%
    å¯¼å¸ˆç­¾åï¼š\ustc@underline{}\par
    \vskip 0.5cm%
    ç­¾å­—æ—¥æœŸï¼š\ustc@underline{}\hspace{2.7cm}%
    ç­¾å­—æ—¥æœŸï¼š\ustc@underline{}\par
  \end{titlepage}%
}
\ifustc@degree@bachelor
  \let\copyrightpage\relax
\fi
% Reserved for compatibility until 2020-07-01.
\let\makestatement\copyrightpage


% \subsection{ç« èŠ‚æ ‡é¢˜}

% æ ‡é¢˜æœ€å¤šå…è®¸ä½¿ç”¨äº”çº§ã€‚
\setcounter{secnumdepth}{5}

% ç ”ç©¶ç”Ÿè§„å®šç« é¢˜ä¸ºä¸¤å­—æ—¶ä¸­é—´ç©ºä¸¤å­—ï¼Œä¸‰å­—æ—¶ç©ºä¸€å­—ï¼Œå››å­—æ—¶ç©ºåŠå­—ï¼Œå››å­—ä»¥ä¸Šä¸ç©ºã€‚
% è¿™é‡Œç”¨ \LaTeX3 çš„ \cs{str\_count:N} åˆ¤æ–­å­—æ•°ã€‚
% æ³¨æ„ï¼Œ\pkg{stringstrings} å®åŒ…ä¼šå¯¼è‡´èŒƒæ•°å‘½ä»¤ \verb+\|+ è¢«ä¿®æ”¹ã€‚
\newcount\ustc@titlelength
\DeclareRobustCommand\ustc@spacetitle[1]{%
  \ustc@titlelength=\csname str_count:N\endcsname{#1}%
  \begingroup
    \ifustc@degree@bachelor
      \if@mainmatter\else
        \ifcase\ustc@titlelength
          \or\or
            \ziju{1}%
          \or\or
            \ziju{0.5}%
        \fi
      \fi
    \else
      \ifcase\ustc@titlelength
        \or\or
          \ziju{2}%
        \or
          \ziju{1}%
        \or
          \ziju{0.5}%
      \fi
    \fi
    #1%
  \endgroup
}

% äº”çº§èŠ‚æ ‡é¢˜å’Œè„šæ³¨éœ€è¦ä½¿ç”¨å¸¦åœˆçš„æ•°å­—ï¼Œè¿™é‡Œä½¿ç”¨ \cs{ustc@circlefont} ï¼š
\newcommand\ustc@textcircled[1]{%
  \ifnum\value{#1}<21\relax
    {\symbol{\numexpr\value{#1} + "245F\relax}}%
  \else
    \ustc@error{Cannot display more than 20 footnotes}%
  \fi
}

% ç”¨ \pkg{ctex} çš„æ¥å£è®¾ç½®å…¨éƒ¨ç« èŠ‚æ ‡é¢˜æ ¼å¼ã€‚

% å„ç« æ ‡é¢˜ï¼šé»‘ä½“ 16 ç£…åŠ ç²—å±…ä¸­ï¼Œå•å€è¡Œè·ï¼Œæ®µå‰ 24 ç£…ï¼Œæ®µå 18 ç£…ï¼Œ
% ç« åºå·ä¸ç« åé—´ç©ºä¸€å­—ã€‚

% ç”±äº Word æ¨¡æ¿ä¸­ä½¿ç”¨â€œå•å€è¡Œè·â€ï¼Œè¿˜â€œå¯¹é½åˆ°ç½‘æ ¼â€ï¼Œè¿™åœ¨ TeX ä¸­ä¸å®¹æ˜“å®ç°ã€‚
% æ‰€ä»¥ç›®å‰æŒ‰ç…§é»˜è®¤çš„è¡Œè·ã€‚

% æ³¨æ„ \pkg{ctex} v2.4.3 ä»¥ä¸‹ç‰ˆæœ¬çš„bugä¼šå¯¼è‡´ç« èŠ‚æ ‡é¢˜å‰åçš„è·ç¦»çš„å®é™…å€¼åå¤§ã€‚
% å¦å¤– \pkg{ctex} v2.2 å‰çš„beforeskipçš„ç¬¦å·æœ‰ç‰¹æ®Šæ„ä¹‰ã€‚
\ctexset{
  chapter = {
    format      = \centering\sffamily\bfseries\fontsize{16bp}{26.67bp}\selectfont,
    nameformat  = {},
    titleformat = \ustc@spacetitle,
    number      = \thechapter,
    aftername   = \hspace{\ccwd},
    beforeskip  = 24bp,
    afterskip   = 18bp,
    fixskip     = true,
  },
}

% ä¸€çº§èŠ‚æ ‡é¢˜ï¼šé»‘ä½“ 14 ç£…å·¦é¡¶æ ¼ï¼Œå•å€è¡Œè·ï¼Œæ®µå‰ 24 ç£…ï¼Œæ®µå 6 ç£…ï¼Œ
% åºå·ä¸é¢˜åé—´ç©ºä¸€å­—ã€‚
\ctexset{
  section = {
    format     = \sffamily\fontsize{14bp}{23.33bp}\selectfont,
    aftername  = \hspace{\ccwd},
    beforeskip = 24bp,
    afterskip  = 6bp,
  },
  %
  % äºŒçº§èŠ‚æ ‡é¢˜ï¼šé»‘ä½“ 13 ç£…ï¼Œå·¦ç¼©è¿›ä¸¤å­—ï¼Œå•å€è¡Œè·ï¼Œæ®µå‰ 12 ç£…ï¼Œæ®µå 6 ç£…ï¼Œ
  % åºå·ä¸é¢˜åé—´ç©ºä¸€å­—ã€‚
  subsection = {
    format     = \sffamily\fontsize{13bp}{21.67bp}\selectfont,
    aftername  = \hspace{\ccwd},
    indent     = 2\ccwd,
    beforeskip = 12bp,
    afterskip  = 6bp,
  },
  %
  % ä¸‰çº§åŠä»¥ä¸‹èŠ‚æ ‡é¢˜çš„æ ¼å¼æ²¡æœ‰å…·ä½“è§„å®šï¼ŒæŒ‰ç…§ Word æ¨¡æ¿çš„æ ¼å¼ï¼š
  % ä½¿ç”¨é»‘ä½“ 12 ç£…ï¼Œå·¦ç¼©è¿›ä¸¤å­—ï¼Œè¡Œè· 20 ç£…ï¼Œæ®µå‰æ®µå 0 ç£…ï¼Œåºå·ä¸é¢˜åé—´ç©ºåŠå­—å®½ã€‚
  subsubsection = {
    format     = \sffamily\fontsize{12bp}{20bp}\selectfont,
    number     = \arabic{subsubsection},
    aftername  = .\hspace{0.5\ccwd},
    indent     = 2\ccwd,
    beforeskip = \z@,
    afterskip  = \z@,
  },
  %
  % æŒ‰ç…§ Word æ¨¡æ¿çš„æ ¼å¼ï¼Œå››çº§èŠ‚æ ‡é¢˜ï¼šå®‹ä½“ 12 ç£…ï¼Œå·¦ç¼©è¿›ä¸¤å­—ï¼Œè¡Œè· 20 ç£…ï¼Œ
  % æ®µå‰æ®µå 0 ç£…ï¼Œåºå·ä½¿ç”¨å…¨å®½æ‹¬å·ï¼Œä¸é¢˜åé—´ç©ºåŠå­—å®½ã€‚
  paragraph = {
    format     = \rmfamily\fontsize{12bp}{20bp}\selectfont,
    number     = ï¼ˆ\arabic{paragraph}ï¼‰,
    aftername  = \hspace{0.5\ccwd},
    indent     = 2\ccwd,
    beforeskip = \z@,
    afterskip  = \z@,
    runin      = false,
  },
  %
  % æŒ‰ç…§ Word æ¨¡æ¿çš„æ ¼å¼ï¼Œäº”çº§èŠ‚æ ‡é¢˜ï¼šå®‹ä½“ 12 ç£…ï¼Œå·¦ç¼©è¿›ä¸¤å­—ï¼Œè¡Œè· 20 ç£…ï¼Œ
  % æ®µå‰æ®µå 0 ç£…ï¼Œåºå·ä½¿ç”¨å…¨å®½æ‹¬å·ï¼Œä¸é¢˜åé—´ç©ºåŠå­—å®½ã€‚
  subparagraph = {
    format     = \rmfamily\fontsize{12bp}{20bp}\selectfont,
    number     = \ustc@textcircled{subparagraph},
    aftername  = \hspace{0.5\ccwd},
    indent     = 2\ccwd,
    beforeskip = \z@,
    afterskip  = \z@,
    runin      = false,
  },
}

\ifustc@degree@bachelor
  \ifustc@main@language@english
    \ustcsetup{section-style = arabic}
  \fi
\fi
\ustc@option@hook{main-language}{%
  \ifustc@degree@bachelor
    \ifustc@main@language@english
      \ustcsetup{section-style = arabic}%
    \fi
  \fi
}

% åœ¨ç ”ç©¶ç”Ÿæ ¼å¼çš„åŸºç¡€ä¸Šå†è®¾ç½®æœ¬ç§‘ç”Ÿçš„ç« èŠ‚æ ‡é¢˜æ ¼å¼ã€‚
\ifustc@degree@bachelor
  \setcounter{secnumdepth}{4}
  \ctexset{
  %
  % è®ºæ–‡çš„è‡´è°¢ã€ç›®å½•ã€æ‘˜è¦å’Œå‚è€ƒæ–‡çŒ®ç­‰æ ‡é¢˜ç”¨å°äºŒå·ï¼ˆ18 bpï¼‰é»‘ä½“å­—ï¼Œå±…ä¸­ï¼Œ
  % è¿™é€šè¿‡ \cs{if@mainmatter} åŒºåˆ†ã€‚
  % æ­£æ–‡ä¸­çš„æ ‡é¢˜åˆ†ç« ã€èŠ‚ã€æ®µä¸‰çº§ï¼›ç« ã€èŠ‚æ ‡é¢˜å±…ä¸­ï¼Œæ®µæ ‡é¢˜å±…å·¦ï¼Œ
  % åˆ†åˆ«ç”¨ä¸‰å·ï¼ˆ16 bpï¼‰é»‘ä½“ã€å°ä¸‰ï¼ˆ15 bpï¼‰é»‘ä½“ã€å››å·ï¼ˆ14 bpï¼‰é»‘ä½“ã€‚
    chapter = {
      format = {
        \centering\sffamily
        \if@mainmatter
          \fontsize{16bp}{29.33bp}\selectfont
        \else
          \fontsize{18bp}{33bp}\selectfont
        \fi
      },
    },
    section = {
      format = \centering\sffamily\fontsize{15bp}{27.5bp}\selectfont,
    },
    subsection = {
      format    = \sffamily\fontsize{14bp}{25.67bp}\selectfont,
      indent    = \z@,
    },
    subsubsection = {
      format    = \rmfamily\fontsize{12bp}{22bp}\selectfont,
      indent    = \ccwd,
    },
    paragraph = {
      format    = \rmfamily\fontsize{12bp}{22bp}\selectfont,
      aftername = {},
      indent    = \ccwd,
    },
  }
  %
  % æœ¬ç§‘ç”Ÿçš„é˜¿æ‹‰ä¼¯æ•°å­—å¼æ ‡é¢˜çš„æ ¼å¼ä¸ç ”ç©¶ç”Ÿå‡ ä¹ä¸€è‡´ï¼Œåªæœ‰ä¸­æ–‡æ•°å­—å¼éœ€è¦ä¿®æ”¹ã€‚
  \ifustc@section@style@arabic\else
    \ctexset{
      chapter = {
        number = \chinese{chapter},
      },
      section = {
        name   = {ç¬¬,èŠ‚},
        number = \chinese{section},
      },
      subsection = {
        number    = \chinese{subsection},
        aftername = {ã€},
      },
    }
  \fi
\fi

% ğŸ˜‹å®éªŒæŠ¥å‘Šçš„ç« èŠ‚æ ‡é¢˜æ ¼å¼ã€‚
\ifustc@degree@report
  \ctexset{
    section = {
      format     = \sffamily\fontsize{14bp}{23.33bp}\selectfont,
      number     = \chinese{section},
      aftername  = ã€\hspace{0.5\ccwd},
    },
    subsection = {
      format    = \sffamily\fontsize{13bp}{21.67bp}\selectfont,
      number     = \arabic{subsection},
      aftername  = ã€\hspace{0.5\ccwd},
      indent    = \z@,
    },
    subsubsection = {
      format    = \rmfamily\fontsize{12bp}{22bp}\selectfont,
      number     = ï¼ˆ\arabic{subsubsection}ï¼‰,
      aftername  = \hspace{0.5\ccwd},
      indent    = \z@,
    },
    paragraph = {
      format    = \rmfamily\fontsize{12bp}{22bp}\selectfont,
      number     = \ustc@textcircled{paragraph},
      aftername  = \hspace{0.5\ccwd},
      indent    = \z@,
    },
  }
\fi

% é»˜è®¤çš„ \cs{chapter*} ç”Ÿæˆçš„ç« æ ‡é¢˜æ²¡æœ‰ç¼–å·ã€ä¸æ›´æ”¹é¡µçœ‰ï¼Œ
% ä¹Ÿä¸æ·»åŠ è¿›ç›®å½•æˆ– PDF ä¹¦ç­¾ã€‚
% ç„¶è€Œåƒæ‘˜è¦ã€ç›®å½•ã€ç¬¦å·è¯´æ˜è¿™æ ·çš„ç« èŠ‚ï¼Œå®ƒä»¬ä¸éœ€è¦ç¼–å·ã€ä¸åŠ å…¥ç›®å½•ï¼Œ
% ä½†æ˜¯éœ€è¦ä¿®æ”¹é¡µçœ‰ï¼Œå¹¶ä¸”åŠ å…¥ PDF æ ‡ç­¾ã€‚
% æ‰€ä»¥æˆ‘ä»¬æ–°å®šä¹‰ \cs{ustc@chapter} ç”¨äºå¤„ç†è¿™äº›ç« èŠ‚ã€‚%
\NewDocumentCommand\ustc@chapter{o m}{%
  \if@openright\cleardoublepage\else\clearpage\fi
  \IfValueTF{#1}{%
    \ustc@pdfbookmark{#1}%
    \chaptermark{#1}%
  }{%
    \ustc@pdfbookmark{#2}%
    \chaptermark{#2}%
  }%
  \chapter*{#2}}
  %
  %
  % \subsection{æ‘˜è¦}
  %
  % ä¸­æ–‡æ‘˜è¦ç¯å¢ƒã€‚
  % åˆ¤æ–­ \cs{ustc@tocloaded} æ˜¯ä¸ºäº†é˜²æ­¢æœ¬ç§‘ç”Ÿæœªè°ƒæ•´æ‘˜è¦ä½ç½®æ—¶çš„ç›®å½•é¡µç ç¼ºå¤±ã€‚
\newcommand\ustc@keywords@text{%
  \ustc@clist@use{\ustc@keywords}{ï¼›}%
}
\newcommand\ustc@keywords@en@text{%
  \ustc@clist@use{\ustc@keywords@en}{; }%
}
\newenvironment{abstract}{%
  \ustcsetup{language=chinese}%
  \ifustc@degree@graduate
    \ustc@chapter{æ‘˜è¦}%
  \else
    \chapter{ä¸­æ–‡å†…å®¹æ‘˜è¦}%
    \ifustc@tocloaded\else
      æœ¬ç§‘ç”Ÿéœ€è¦æ‰‹åŠ¨å°†æ‘˜è¦ç½®äºç›®å½•åã€‚\par
    \fi
  \fi
}{
  \par\null\par\noindent\hangindent=4\ccwd\relax
  \textbf{å…³é”®è¯}ï¼š\ustc@keywords@text\par
  \ustc@reset@main@language
}

% è‹±æ–‡æ‘˜è¦ç¯å¢ƒ
\newenvironment{abstract*}{%
  \ustcsetup{language=english}%
  \ifustc@degree@graduate
    \ustc@chapter[Abstract]{ABSTRACT}%
  \else
    \begingroup
      \ctexset{chapter/format=\centering\fontsize{16bp}{29.33bp}\selectfont}%
      \chapter[è‹±æ–‡å†…å®¹æ‘˜è¦]{Abstract}%
    \endgroup
  \fi
}{
  \par\null\par\noindent\hangindent=5.3em\relax
  \textbf{Key Words}: \ustc@keywords@en@text\par
  \ifustc@degree@graduate
    \cleardoublepage
  \fi
  \ustc@reset@main@language
}

% Reserved for compatibility until 2020-07-01.
\newenvironment{enabstract}{%
  \begin{abstract*}%
}{%
  \end{abstract*}%
}


% \subsection{ç›®å½•}

% åˆ¤æ–­æ˜¯å¦å·²ç»åŠ è½½ç›®å½•ï¼Œç”¨äºæé†’æœ¬ç§‘ç”Ÿæ›´æ”¹æ‘˜è¦å’Œè‡´è°¢çš„é¡ºåºã€‚
\newif\ifustc@tocloaded

% ç ”ç©¶ç”Ÿè§„å®šç›®å½•å¦é¢èµ·ï¼›
% æœ¬ç§‘ç”Ÿè§„å®šä»ç›®å½•å¼€å§‹ç¼–é¡µç ï¼Œæ‰€ä»¥å¿…é¡»å¦é¡µèµ·ã€‚
\renewcommand\tableofcontents{%
  \ifustc@degree@bachelor
    \cleardoublepage
    \pagenumbering{arabic}%
    \pagestyle{plain}%
    \ustc@tocloadedtrue
  \fi
  \ustc@chapter{\contentsname}%
  \@starttoc{toc}%
}

% ä¸‹é¢ç”¨ \pkg{titletoc} å®åŒ…è®¾ç½®ç›®å½•å†…å®¹çš„æ ¼å¼ã€‚
% å…ˆå®šä¹‰ç›®å½•çº¿ï¼š
\newcommand\ustc@leaders{\titlerule*[9bp]{\textperiodcentered}}

% å„ç« ç›®å½•è¦æ±‚å®‹ä½“ 14 ç£…ï¼Œå•å€è¡Œè·ï¼Œæ®µå‰ 6 ç£…ï¼Œæ®µå 0 ç£…ï¼Œä¸¤ç«¯å¯¹é½ï¼Œ
% é¡µç å³å¯¹é½ï¼Œç« åºå·ä¸ç« åé—´ç©ºä¸€å­—ã€‚
% ä½†æ˜¯ Word æ¨¡æ¿ä¸­å®é™…æ˜¯è¡Œè· 20 ç£…ã€‚
\ifustc@degree@bachelor
  % æœ¬ç§‘ç”Ÿçš„ç›®å½•ä½¿ç”¨å°å››å®‹ä½“ï¼ˆåŒæ­£æ–‡å­—ä½“ï¼‰ï¼Œå…¶ä»–åŒç ”ç©¶ç”Ÿçš„æ ¼å¼ç›¸è¿‘ã€‚
  \titlecontents{chapter}
  [\z@]{\normalsize}
  {\contentspush{\thecontentslabel\unskip\hspace{\ccwd}}}{}
  {\ustc@leaders\contentspage}
  \titlecontents{section}
  [\ccwd]{\normalsize}
  {\contentspush{\thecontentslabel\hspace{\ccwd}}}{}
  {\ustc@leaders\contentspage}
  \titlecontents{subsection}
  [2\ccwd]{\normalsize}
  {\contentspush{\thecontentslabel
    \ifustc@section@style@arabic\hspace{\ccwd}\else ã€\fi}}{}
  {\ustc@leaders\contentspage}
\else
  \titlecontents{chapter}
  [\z@]{\addvspace{6bp}\fontsize{14bp}{20bp}\selectfont}
  {\contentspush{\thecontentslabel\hspace{\ccwd}}}{}
  {\fontsize{12bp}{20bp}\selectfont\ustc@leaders\contentspage}
  %
  % ä¸€çº§èŠ‚æ ‡é¢˜ç›®å½•è¦æ±‚å®‹ä½“ 12 ç£…ï¼Œå•å€è¡Œè·ï¼Œå·¦ç¼©è¿›ä¸€å­—ï¼Œæ®µå‰ 6 ç£…ï¼Œæ®µå 0 ç£…ï¼Œ
  % ä¸¤ç«¯å¯¹é½ï¼Œé¡µç å³å¯¹é½ï¼Œåºå·ä¸é¢˜åé—´ç©ºä¸€å­—ã€‚
  % Word æ¨¡æ¿ä¸­å®é™…æ˜¯è¡Œè· 20 ç£…ï¼Œæ®µå‰ 0 ç£…ã€‚
  \ifustc@degree@report
    \titlecontents{section}
    [\z@]{\addvspace{6bp}\fontsize{14bp}{20bp}\selectfont}
    {\contentspush{\thecontentslabelã€\hspace{\ccwd}}}{}
    {\fontsize{12bp}{20bp}\selectfont\ustc@leaders\contentspage}
  \else
    \titlecontents{section}
    [\ccwd]{\fontsize{12bp}{20bp}\selectfont}
    {\contentspush{\thecontentslabel\hspace{\ccwd}}}{}
    {\ustc@leaders\contentspage}
  \fi
  %
  % äºŒçº§èŠ‚æ ‡é¢˜ç›®å½•è¦æ±‚ä»¿å®‹ 12 ç£…ï¼Œå•å€è¡Œè·ï¼Œå·¦ç¼©è¿›ä¸¤å­—ï¼Œæ®µå‰ 6 ç£…ï¼Œæ®µå 0 ç£…ï¼Œ
  % ä¸¤ç«¯å¯¹é½ï¼Œé¡µç å³å¯¹é½ï¼Œåºå·ä¸é¢˜åé—´ç©ºä¸€å­—ã€‚
  % Word æ¨¡æ¿ä¸­å®é™…æ˜¯è¡Œè· 20 ç£…ï¼Œæ®µå‰ 0 ç£…ã€‚
  \ifustc@degree@report
  \titlecontents{subsection}
  [2\ccwd]{\fangsong\fontsize{12bp}{20bp}\selectfont}
  {\contentspush{\thecontentslabelï¼‰\hspace{\ccwd}}}{}
  {\ustc@leaders\contentspage}
  \else
    \titlecontents{subsection}
    [2\ccwd]{\fangsong\fontsize{12bp}{20bp}\selectfont}
    {\contentspush{\thecontentslabel\hspace{\ccwd}}}{}
    {\ustc@leaders\contentspage}
  \fi
  %
\fi

% æœ¬ç§‘ç”Ÿè¦æ±‚ç›®å½•ä¸­æ­£æ–‡æ¯ç« å‰å¤šç©ºä¸€è¡Œï¼Œè€Œç›®å½•ã€é™„å½•ç­‰ç« åˆ™ä¸éœ€è¦ç©ºè¡Œï¼Œ
% æ‰€ä»¥ä¸èƒ½ç®€å•åˆ¤æ–­ \cs{if@mainmatter}ï¼Œéœ€è¦é‡æ–°å®šä¹‰ \cs{mainmatter} ç­‰å‘½ä»¤ã€‚
\newif\ifustc@addtocspace
\ifustc@degree@bachelor
  \ustc@addtocspacetrue
  \g@addto@macro\frontmatter{\ustc@addtocspacefalse}%
  \g@addto@macro\mainmatter{\ustc@addtocspacetrue}%
  \g@addto@macro\backmatter{\ustc@addtocspacefalse}%
  \g@addto@macro\appendix{\ustc@addtocspacefalse}%
\fi

% å¤„ç†æœ¬ç§‘ç”Ÿåœ¨ç›®å½•ä¸­æ·»åŠ ç©ºè¡Œã€‚
\renewcommand\chapter{%
  \if@openright\cleardoublepage\else\clearpage\fi
  \thispagestyle{\CTEX@chapter@pagestyle}%
  \global\@topnum\z@
  \@afterindenttrue
  \ifustc@degree@bachelor
    \ifustc@addtocspace
      \addtocontents{toc}{\protect\addvspace{12bp}}%
    \fi
  \fi
  \secdef\@chapter\@schapter
}

% ç ”ç©¶ç”Ÿè¦æ±‚å›¾ã€è¡¨çš„æ¸…å•é¡»å¦é¡µèµ·ã€‚
\newlength{\ustc@lof@label@width}
\newcommand\ustc@set@lof@format{%
  \settowidth{\ustc@lof@label@width}{\figurename~9.99}%
  \addtolength{\ustc@lof@label@width}{1em}%
  \titlecontents{figure}%
    [\ustc@lof@label@width]{\normalsize}%
    {\contentslabel[\figurename~\thecontentslabel]{\ustc@lof@label@width}}{}%
    {\ustc@leaders\contentspage}%
  \titlecontents{table}%
    [\ustc@lof@label@width]{\normalsize}%
    {\contentslabel[\tablename~\thecontentslabel]{\ustc@lof@label@width}}{}%
    {\ustc@leaders\contentspage}%
}
\ustc@set@lof@format
\ustc@option@hook{main-language}{\ustc@set@lof@format}
\renewcommand\listoffigures{%
  \ifustc@degree@graduate
    \cleardoublepage
  \fi
  \ustc@chapter{\listfigurename}%
  \@starttoc{lof}%
}
\renewcommand\listoftables{%
  \ifustc@degree@graduate
    \cleardoublepage
  \fi
  \ustc@chapter{\listtablename}%
  \@starttoc{lot}%
}


% \subsection{ç¬¦å·è¯´æ˜}

% ç ”ç©¶ç”Ÿè§„å®šç¬¦å·è¯´æ˜å¦é¡µèµ·ï¼Œæ ‡é¢˜å­—ä½“å­—å·ç­‰åŒè®ºæ–‡æ­£æ–‡ï¼Œ
% ã€Šæ’°å†™æ‰‹å†Œã€‹ç¬¬ 9 é¡µ 1.10(2) è¿˜è§„å®šâ€œç¬¦å·è¯´æ˜ä¸åŠ é¡µç â€ã€‚
\newenvironment{notation}{%
  \ifustc@degree@graduate
    \cleardoublepage
    \pagestyle{headings}%
  \fi
  \ustc@chapter{\ustc@notation@name}%
}{%
  \ifustc@degree@graduate
    \clearpage
    \pagestyle{plain}%
  \fi
}%
\newcommand*\notationlabel[1]{#1\hfil}%
\newenvironment{notationlist}[1]{%
  \list{}{%
    \itemsep 3bp%
    \labelwidth #1\relax%
    \labelsep 1em%
    \leftmargin\labelwidth
    \advance\leftmargin\labelsep
    \advance\leftmargin 3em%
    \rightmargin 3em%
    \let\makelabel\notationlabel
  }%
}{%
  \endlist
}


% \subsection{æ­£æ–‡}

% \cs{sloppy} å¯ä»¥å‡å°‘â€œoverfull boxesâ€ã€‚
\sloppy

% ç¦æ­¢æ‰©å¤§æ®µé—´è·ã€‚ï¼ˆ\href{https://github.com/ustctug/ustcthesis/issues/209}{
%   ustctug/ustcthesis\#209}ï¼‰
\raggedbottom

% æ®µé—´è· 0 ç£…ã€‚
\setlength{\parskip}{\z@}

% é¦–æ®µç¼©è¿›ã€‚
\ctexset{autoindent=2}

% é¦–æ®µç¼©è¿›ã€‚
\let\@afterindentfalse\@afterindenttrue
\@afterindenttrue

% URL çš„å­—ä½“è®¾ä¸ºä¿æŒåŸæ ·ã€‚
\urlstyle{same}

% ä½¿ç”¨ \pkg{xurl} å®åŒ…çš„æ–¹æ³•ï¼Œå¢åŠ  URL å¯æ–­è¡Œçš„ä½ç½®ã€‚
\def\UrlBreaks{%
  \do\/%
  \do\a\do\b\do\c\do\d\do\e\do\f\do\g\do\h\do\i\do\j\do\k\do\l%
     \do\m\do\n\do\o\do\p\do\q\do\r\do\s\do\t\do\u\do\v\do\w\do\x\do\y\do\z%
  \do\A\do\B\do\C\do\D\do\E\do\F\do\G\do\H\do\I\do\J\do\K\do\L%
     \do\M\do\N\do\O\do\P\do\Q\do\R\do\S\do\T\do\U\do\V\do\W\do\X\do\Y\do\Z%
  \do0\do1\do2\do3\do4\do5\do6\do7\do8\do9\do=\do/\do.\do:%
  \do\*\do\-\do\~\do\'\do\"\do\-}
\Urlmuskip=0mu plus 0.1mu

% è„šæ³¨ç”¨å¸¦åœˆçš„æ•°å­—ï¼š
\renewcommand\thefootnote{\ustc@textcircled{footnote}}

% LaTeX é»˜è®¤è„šæ³¨æŒ‰ç« è®¡æ•°ï¼Œå³æ¯ç« çš„å¼€å§‹æ‰é‡ç½®è„šæ³¨è®¡æ•°å™¨ï¼›æˆ‘ä»¬ä¿®æ”¹ä¸ºæŒ‰é¡µè®¡æ•°ã€‚
% ç®€å•çš„|\@addtoreset{footnote}{page}|å¹¶ä¸å¯é ï¼Œ
% \footnote{\url{https://texfaq.org/FAQ-footnpp.html}}
% æ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨ \pkg{footmisc} å®åŒ…ã€‚

% è„šæ³¨çº¿é•¿ä¸ºç‰ˆå¿ƒå®½åº¦çš„å››åˆ†ä¹‹ä¸€ï¼š
\renewcommand\footnoterule{%
  \kern-3\p@
  \hrule\@width.25\textwidth
  \kern2.6\p@}
  %
  % æ³¨æ–‡ç¼©è¿›ä¸¤å­—ï¼š
\renewcommand\@makefntext[1]{%
  \parindent 2\ccwd\relax
  \noindent
  \hb@xt@2\ccwd{\hss\@makefnmark}#1}


% \subsection{åˆ—è¡¨}
% \label{sec:list}

% è°ƒæ•´åˆ—è¡¨ä¸­å„é¡¹ä¹‹é—´è¿‡å¤§çš„é—´è·ã€‚
\setlength\partopsep{\z@}
\newcommand\ustc@nolistsep{%
  \parsep 0\p@ \@plus.2\p@
  \topsep 0\p@ \@plus.2\p@
  \itemsep0\p@ \@plus.2\p@
}
\def\@listi{\leftmargin\leftmargini
            \ustc@nolistsep}
\let\@listI\@listi
\@listi
\def\@listii {\leftmargin\leftmarginii
              \labelwidth\leftmarginii
              \advance\labelwidth-\labelsep
              \ustc@nolistsep}
\def\@listiii{\leftmargin\leftmarginiii
              \labelwidth\leftmarginiii
              \advance\labelwidth-\labelsep
              \ustc@nolistsep}


% \subsection{æµ®åŠ¨ä½“}

% \LaTeX{} å¯¹æ”¾ç½®æµ®åŠ¨ä½“çš„è¦æ±‚æ¯”è¾ƒå¼ºï¼Œè¿™é‡ŒæŒ‰ç…§ UK TeX FAQ çš„å»ºè®®
% \footnote{\url{https://texfaq.org/FAQ-floats}} å¯¹å…¶é€‚å½“æ”¾å®½ã€‚
\renewcommand\topfraction{.85}
\renewcommand\bottomfraction{.7}
\renewcommand\textfraction{.15}
\renewcommand\floatpagefraction{.66}
\renewcommand\dbltopfraction{.66}
\renewcommand\dblfloatpagefraction{.66}
\setcounter{topnumber}{9}
\setcounter{bottomnumber}{9}
\setcounter{totalnumber}{20}
\setcounter{dbltopnumber}{9}

% ä¿®æ”¹é»˜è®¤çš„æµ®åŠ¨ä½“æè¿°ç¬¦ä¸º |h|ã€‚
\def\fps@figure{h}
\def\fps@table{h}

% ç”¨ \pkg{caption} å®åŒ…è®¾ç½®å›¾ã€è¡¨çš„æ ¼å¼ï¼š

% å›¾å·ã€å›¾é¢˜ç½®äºå›¾çš„ä¸‹æ–¹ï¼Œå®‹ä½“ 10.5 ç£…å±…ä¸­ï¼Œå•å€è¡Œè·ï¼Œæ®µå‰ 6 ç£…ï¼Œæ®µå 12 ç£…ï¼Œ
% å›¾å·ä¸å›¾é¢˜æ–‡å­—ä¹‹é—´ç©ºä¸€å­—ï¼Œå›¾å·ã€å›¾é¢˜åŠ ç²—ã€‚
% å›¾æ³¨ä½äºå›¾çš„ä¸‹æ–¹ï¼Œå·¦ç¼©è¿›ä¸¤å­—ï¼Œç»­è¡Œæ‚¬æŒ‚ç¼©è¿›å·¦å¯¹é½ï¼Œä¸¤ç«¯å¯¹é½ã€‚

% è¡¨å·ã€è¡¨é¢˜ç½®äºè¡¨çš„ä¸Šæ–¹ï¼Œé»‘ä½“ 10.5 ç£…å±…ä¸­ï¼Œå•å€è¡Œè·ï¼Œæ®µå‰ 6 ç£…ï¼Œæ®µå 6 ç£…ï¼Œ
% è¡¨å·ä¸è¡¨é¢˜æ–‡å­—ä¹‹é—´ç©ºä¸€å­—ï¼Œè¡¨å·ã€è¡¨é¢˜åŠ ç²—ã€‚
% è¡¨æ³¨å·¦ç¼©è¿›ä¸¤å­—ï¼Œç»­è¡Œæ‚¬æŒ‚ç¼©è¿›å·¦å¯¹é½ï¼Œä¸¤ç«¯å¯¹é½ã€‚
\setlength{\floatsep}{6bp}
\setlength{\textfloatsep}{6bp}
\setlength{\intextsep}{6bp}

\DeclareCaptionFont{ustc}{%
  \ifustc@language@chinese
    \fontsize{10.5bp}{13.65bp}\selectfont
  \else
    \fontsize{10.5bp}{12.075bp}\selectfont
  \fi
}

\captionsetup{
  font           = ustc,
  labelsep       = quad,
  skip           = 6bp,
  figureposition = bottom,
  tableposition  = top,
}
\ifustc@degree@graduate
  \captionsetup{font+=bf}
  \captionsetup[table]{font+=sf}
\fi
\captionsetup[figure]{
  belowskip = 6bp,
}

% ç”±äº LaTeX2e kernel çš„é—®é¢˜ï¼Œå›¾è¡¨ç­‰æµ®åŠ¨ä½“ä¸æ–‡å­—å‰åçš„è·ç¦»ä¸ä¸€è‡´ï¼Œéœ€è¦è¿›è¡Œ patchã€‚
% å‚è€ƒ \href{https://github.com/tuna/thuthesis/issues/614}{tuna/thuthesis/issues\#614}ã€
% \url{https://www.zhihu.com/question/46618031} å’Œ
% \url{https://tex.stackexchange.com/a/40363/82731}ã€‚
%    \begin{macrocode}
\patchcmd{\@addtocurcol}%
  {\vskip \intextsep}%
  {\edef\save@first@penalty{\the\lastpenalty}\unpenalty
   \ifnum \lastpenalty = \@M  % hopefully the OR penalty
     \unpenalty
   \else
     \penalty \save@first@penalty \relax % put it back
   \fi
   \ifnum\outputpenalty <-\@Mii
     \addvspace\intextsep
     \vskip\parskip
   \else
     \addvspace\intextsep
   \fi}%
  {}{\ustc@patch@error{\@addtocurcol}}
\patchcmd{\@addtocurcol}%
  {\vskip\intextsep \ifnum\outputpenalty <-\@Mii \vskip -\parskip\fi}%
  {\ifnum\outputpenalty <-\@Mii
     \aftergroup\vskip\aftergroup\intextsep
     \aftergroup\nointerlineskip
   \else
     \vskip\intextsep
   \fi}%
  {}{\ustc@patch@error{\@addtocurcol}}
\patchcmd{\@getpen}{\@M}{\@Mi}
  {}{\ustc@patch@error{\@getpen}}

% æ–°å®šä¹‰äº† \cs{note} æ¥ç”Ÿæˆå›¾è¡¨çš„é™„æ³¨ã€‚
% å¦‚æœç”¨ \cs{caption} ç”Ÿæˆå›¾è¡¨çš„é™„æ³¨ä¼šå¯¼è‡´å›¾è¡¨çš„åºå·æœ‰è¯¯ï¼›
% å¦‚æœç”¨ \cs{bicaption} ä¼šå¯¼è‡´è¡¨æ³¨æ— æ³•ç½®äºè¡¨åï¼Œè€Œä¸”å¯¹é½æ–¹å¼ä¸å¯¹ã€‚
\newcommand\note[1]{%
  \begingroup
    \captionsetup{
      font          = ustc,
      margin        = 2\ccwd,
      position      = bottom,
    }%
    \caption*{#1}%
  \endgroup
}

% è¡¨æ ¼é»˜è®¤å­—å·ç•¥å°
\patchcmd\@floatboxreset{%
  \normalsize
}{%
  \small
}{}{\ustc@patch@error{\@floatboxreset}}

% å¯¹ \pkg{longtable} è·¨é¡µè¡¨æ ¼è¿›è¡Œç›¸åŒçš„è®¾ç½®ã€‚
%
% åœ¨ Word æ¨¡æ¿ä¸­æŒ‰ç…§æ­£ç¡®çš„è®¾ç½®ï¼ˆéœ€è¦å»æ‰æ–‡æ¡£ç½‘æ ¼ï¼‰ï¼Œ
% ä¸­æ–‡æ¨¡æ¿æ¯é¡µèƒ½è£…ä¸‹ 1 è¡Œæ ‡é¢˜ã€1 è¡Œè¡¨å¤´ã€30 è¡Œè¡¨èº«ï¼Œ
% è‹±æ–‡æ¨¡æ¿æ¯é¡µèƒ½è£…ä¸‹ 1 è¡Œæ ‡é¢˜ã€1 è¡Œè¡¨å¤´ã€33 è¡Œè¡¨èº«ã€‚
%    \begin{macrocode}
\AtEndOfPackageFile*{longtable}{
  \AtBeginEnvironment{longtable}{%
    \ifdim\f@size pt > 12pt\relax
      \small
    \fi
  }
}


% \subsection{å‚è€ƒæ–‡çŒ®}

\PassOptionsToPackage{compress}{natbib}

\AtEndOfPackageFile*{natbib}{
  % å®šä¹‰å‡ ç§å¼•ç”¨æ–‡çŒ®çš„æ ‡æ³¨æ ·å¼ã€‚
  \newcommand\bibstyle@super{\bibpunct{[}{]}{,}{s}{,}{\textsuperscript{,}}}
  \newcommand\bibstyle@inline{\bibpunct{[}{]}{,}{n}{,}{,}}
  \newcommand\bibstyle@authoryear{\bibpunct{(}{)}{;}{a}{,}{,}}
  \@namedef{bibstyle@author-year}{\bibstyle@authoryear}
  %
  % å‡ ç§ç§å¼•ç”¨æ ·å¼ï¼Œä¸ \file{bst} æ–‡ä»¶åä¿æŒä¸€è‡´ï¼Œ
  % è¿™æ ·åœ¨ä½¿ç”¨ \cs{bibliographystyle} é€‰æ‹©å‚è€ƒæ–‡çŒ®è¡¨çš„æ ·å¼æ—¶ä¹Ÿä¼šè®¾ç½®å¯¹åº”çš„å¼•ç”¨æ ·å¼ã€‚
  \@namedef{bibstyle@ustcthesis-numerical}{\bibstyle@super}
  \@namedef{bibstyle@ustcthesis-authoryear}{\bibstyle@authoryear}
  \@namedef{bibstyle@ustcthesis-bachelor}{\bibstyle@super}
  %
  % å¦‚æœè½½å…¥ `natbib` å‰è®¾ç½®äº† `cite-style`ï¼Œè¿™é‡Œå…ˆè¿›è¡Œé…ç½®ã€‚
  % https://github.com/ustctug/ustcthesis/issues/327
  \ifx\ustc@cite@style\@empty\else
    \citestyle{\ustc@cite@style}%
  \fi
  %
  % å®šä¹‰æ¥å£ cite-style åˆ‡æ¢å¼•ç”¨æ ·å¼ã€‚
  \ustc@option@hook{cite-style}{%
    \citestyle{\ustc@cite@style}%
  }
  %
  % å¦‚æœæ–‡çŒ®åºå·ä½œä¸ºå™è¿°æ–‡å­—çš„ä¸€éƒ¨åˆ†ï¼Œéœ€è¦ä¸´æ—¶å°†æ–‡çŒ®åºå·ä¸æ­£æ–‡å¹³æ’
  \DeclareRobustCommand\inlinecite{\@inlinecite}
  \def\@inlinecite#1{\begingroup\let\@cite\NAT@citenum\citep{#1}\endgroup}
  %
  % ä¿®æ”¹å¼•ç”¨çš„æ ·å¼ã€‚
  % è¿™é‡Œåœ¨ filehook ä¸­æ— æ³•ä½¿ç”¨ \cs{patchcmd}ï¼Œæ‰€ä»¥åªèƒ½æ‰‹åŠ¨é‡å®šä¹‰ã€‚
  %
  % å°† super å¼ \cs{citep} å¼•ç”¨çš„é¡µç ç½®äºæ‹¬å·å¤–ã€‚
  \renewcommand\NAT@citesuper[3]{%
    \ifNAT@swa
      \if*#2*\else
        #2\NAT@spacechar
      \fi
      % \unskip\kern\p@\textsuperscript{\NAT@@open#1\NAT@@close}%
      %  \if*#3*\else\NAT@spacechar#3\fi\else #1\fi\endgroup}
      \unskip\kern\p@
      \textsuperscript{%
        \NAT@@open#1\NAT@@close
        \if*#3*\else#3\fi
      }%
      \kern\p@
    \else
      #1%
    \fi
    \endgroup
  }
  %
  % å°† numbers å¼ \cs{citep} å¼•ç”¨çš„é¡µç ç½®äºæ‹¬å·å¤–å¹¶æ”¹ä¸ºä¸Šæ ‡ã€‚
  \renewcommand\NAT@citenum[3]{%
    \ifNAT@swa
      \NAT@@open
      \if*#2*\else
        #2\NAT@spacechar
      \fi
      % #1\if*#3*\else\NAT@cmt#3\fi\NAT@@close
      #1\NAT@@close
      \if*#3*\else
        \textsuperscript{#3}%
      \fi
    \else
      #1%
    \fi
    \endgroup
  }
  %
  % åœ¨ filehook ä¸­æ— æ³•ä½¿ç”¨ \cs{patchcmd}ï¼Œæ‰€ä»¥åªèƒ½æ‰‹åŠ¨é‡å®šä¹‰ã€‚
  \def\NAT@citexnum[#1][#2]#3{%
    \NAT@reset@parser
    \NAT@sort@cites{#3}%
    \NAT@reset@citea
    \@cite{\def\NAT@num{-1}\let\NAT@last@yr\relax\let\NAT@nm\@empty
      \@for\@citeb:=\NAT@cite@list\do
      {\@safe@activestrue
      \edef\@citeb{\expandafter\@firstofone\@citeb\@empty}%
      \@safe@activesfalse
      \@ifundefined{b@\@citeb\@extra@b@citeb}{%
        {\reset@font\bfseries?}
          \NAT@citeundefined\PackageWarning{natbib}%
        {Citation `\@citeb' on page \thepage \space undefined}}%
      {\let\NAT@last@num\NAT@num\let\NAT@last@nm\NAT@nm
        \NAT@parse{\@citeb}%
        \ifNAT@longnames\@ifundefined{bv@\@citeb\@extra@b@citeb}{%
          \let\NAT@name=\NAT@all@names
          \global\@namedef{bv@\@citeb\@extra@b@citeb}{}}{}%
        \fi
        \ifNAT@full\let\NAT@nm\NAT@all@names\else
          \let\NAT@nm\NAT@name\fi
        \ifNAT@swa
        \@ifnum{\NAT@ctype>\@ne}{%
          \@citea
          \NAT@hyper@{\@ifnum{\NAT@ctype=\tw@}{\NAT@test{\NAT@ctype}}{\NAT@alias}}%
        }{%
          \@ifnum{\NAT@cmprs>\z@}{%
          \NAT@ifcat@num\NAT@num
            {\let\NAT@nm=\NAT@num}%
            {\def\NAT@nm{-2}}%
          \NAT@ifcat@num\NAT@last@num
            {\@tempcnta=\NAT@last@num\relax}%
            {\@tempcnta\m@ne}%
          \@ifnum{\NAT@nm=\@tempcnta}{%
            \@ifnum{\NAT@merge>\@ne}{}{\NAT@last@yr@mbox}%
          }{%
            \advance\@tempcnta by\@ne
            \@ifnum{\NAT@nm=\@tempcnta}{%
              % åœ¨é¡ºåºç¼–ç åˆ¶ä¸‹ï¼Œ\pkg{natbib} åªæœ‰åœ¨ä¸‰ä¸ªä»¥ä¸Šè¿ç»­æ–‡çŒ®å¼•ç”¨æ‰ä¼šä½¿ç”¨è¿æ¥å·ï¼Œ
              % è¿™é‡Œä¿®æ”¹ä¸ºå…è®¸ä¸¤ä¸ªå¼•ç”¨ä½¿ç”¨è¿æ¥å·ã€‚
              % å‚è€ƒ https://tex.stackexchange.com/a/86991/82731 ã€‚
              %
              % \ifx\NAT@last@yr\relax
              %   \def@NAT@last@yr{\@citea}%
              % \else
              %   \def@NAT@last@yr{--\NAT@penalty}%
              % \fi
              \def@NAT@last@yr{-\NAT@penalty}%
            }{%
              \NAT@last@yr@mbox
            }%
          }%
          }{%
          \@tempswatrue
          \@ifnum{\NAT@merge>\@ne}{\@ifnum{\NAT@last@num=\NAT@num\relax}{\@tempswafalse}{}}{}%
          \if@tempswa\NAT@citea@mbox\fi
          }%
        }%
        \NAT@def@citea
        \else
          \ifcase\NAT@ctype
            \ifx\NAT@last@nm\NAT@nm \NAT@yrsep\NAT@penalty\NAT@space\else
              \@citea \NAT@test{\@ne}\NAT@spacechar\NAT@mbox{\NAT@super@kern\NAT@@open}%
            \fi
            \if*#1*\else#1\NAT@spacechar\fi
            \NAT@mbox{\NAT@hyper@{{\citenumfont{\NAT@num}}}}%
            \NAT@def@citea@box
          \or
            \NAT@hyper@citea@space{\NAT@test{\NAT@ctype}}%
          \or
            \NAT@hyper@citea@space{\NAT@test{\NAT@ctype}}%
          \or
            \NAT@hyper@citea@space\NAT@alias
          \fi
        \fi
      }%
      }%
        \@ifnum{\NAT@cmprs>\z@}{\NAT@last@yr}{}%
        \ifNAT@swa\else
          % å°† numerical å¼ \cs{citet} å¼•ç”¨çš„é¡µç ç½®äºæ‹¬å·å¤–å¹¶æ”¹ä¸ºä¸Šæ ‡ã€‚
          %
          % \@ifnum{\NAT@ctype=\z@}{%
          %   \if*#2*\else\NAT@cmt#2\fi
          % }{}%
          \NAT@mbox{\NAT@@close}%
          \@ifnum{\NAT@ctype=\z@}{%
            \if*#2*\else
              \textsuperscript{#2}%
            \fi
          }{}%
          \NAT@super@kern
        \fi
    }{#1}{#2}%
  }%
  %
  % å°† author-year å¼ \cs{citep} å¼•ç”¨çš„é¡µç ç½®äºæ‹¬å·å¤–å¹¶æ”¹ä¸ºä¸Šæ ‡ï¼š
  \renewcommand\NAT@cite%
      [3]{\ifNAT@swa\NAT@@open\if*#2*\else#2\NAT@spacechar\fi
          % #1\if*#3*\else\NAT@cmt#3\fi\NAT@@close\else#1\fi\endgroup}
          #1\NAT@@close\if*#3*\else\textsuperscript{#3}\fi\else#1\fi\endgroup}
  %
  % è°ƒæ•´ author-year å¼ \cs{citet} å¼•ç”¨çš„é¡µç ã€‚
  \def\NAT@citex%
    [#1][#2]#3{%
    \NAT@reset@parser
    \NAT@sort@cites{#3}%
    \NAT@reset@citea
    \@cite{\let\NAT@nm\@empty\let\NAT@year\@empty
      \@for\@citeb:=\NAT@cite@list\do
      {\@safe@activestrue
      \edef\@citeb{\expandafter\@firstofone\@citeb\@empty}%
      \@safe@activesfalse
      \@ifundefined{b@\@citeb\@extra@b@citeb}{\@citea%
        {\reset@font\bfseries ?}\NAT@citeundefined
                  \PackageWarning{natbib}%
        {Citation `\@citeb' on page \thepage \space undefined}\def\NAT@date{}}%
      {\let\NAT@last@nm=\NAT@nm\let\NAT@last@yr=\NAT@year
        \NAT@parse{\@citeb}%
        \ifNAT@longnames\@ifundefined{bv@\@citeb\@extra@b@citeb}{%
          \let\NAT@name=\NAT@all@names
          \global\@namedef{bv@\@citeb\@extra@b@citeb}{}}{}%
        \fi
      \ifNAT@full\let\NAT@nm\NAT@all@names\else
        \let\NAT@nm\NAT@name\fi
      \ifNAT@swa\ifcase\NAT@ctype
        \if\relax\NAT@date\relax
          \@citea\NAT@hyper@{\NAT@nmfmt{\NAT@nm}\NAT@date}%
        \else
          \ifx\NAT@last@nm\NAT@nm\NAT@yrsep
              \ifx\NAT@last@yr\NAT@year
                \def\NAT@temp{{?}}%
                \ifx\NAT@temp\NAT@exlab\PackageWarningNoLine{natbib}%
                {Multiple citation on page \thepage: same authors and
                year\MessageBreak without distinguishing extra
                letter,\MessageBreak appears as question mark}\fi
                \NAT@hyper@{\NAT@exlab}%
              \else\unskip\NAT@spacechar
                \NAT@hyper@{\NAT@date}%
              \fi
          \else
            \@citea\NAT@hyper@{%
              \NAT@nmfmt{\NAT@nm}%
              \hyper@natlinkbreak{%
                \NAT@aysep\NAT@spacechar}{\@citeb\@extra@b@citeb
              }%
              \NAT@date
            }%
          \fi
        \fi
      \or\@citea\NAT@hyper@{\NAT@nmfmt{\NAT@nm}}%
      \or\@citea\NAT@hyper@{\NAT@date}%
      \or\@citea\NAT@hyper@{\NAT@alias}%
      \fi \NAT@def@citea
      \else
        \ifcase\NAT@ctype
          \if\relax\NAT@date\relax
            \@citea\NAT@hyper@{\NAT@nmfmt{\NAT@nm}}%
          \else
          \ifx\NAT@last@nm\NAT@nm\NAT@yrsep
              \ifx\NAT@last@yr\NAT@year
                \def\NAT@temp{{?}}%
                \ifx\NAT@temp\NAT@exlab\PackageWarningNoLine{natbib}%
                {Multiple citation on page \thepage: same authors and
                year\MessageBreak without distinguishing extra
                letter,\MessageBreak appears as question mark}\fi
                \NAT@hyper@{\NAT@exlab}%
              \else
                \unskip\NAT@spacechar
                \NAT@hyper@{\NAT@date}%
              \fi
          \else
            \@citea\NAT@hyper@{%
              \NAT@nmfmt{\NAT@nm}%
              \hyper@natlinkbreak{\NAT@spacechar\NAT@@open\if*#1*\else#1\NAT@spacechar\fi}%
                {\@citeb\@extra@b@citeb}%
              \NAT@date
            }%
          \fi
          \fi
        \or\@citea\NAT@hyper@{\NAT@nmfmt{\NAT@nm}}%
        \or\@citea\NAT@hyper@{\NAT@date}%
        \or\@citea\NAT@hyper@{\NAT@alias}%
        \fi
        \if\relax\NAT@date\relax
          \NAT@def@citea
        \else
          \NAT@def@citea@close
        \fi
      \fi
      }}\ifNAT@swa\else
        % å°† author-year å¼ \cs{citet} å¼•ç”¨çš„é¡µç ç½®äºæ‹¬å·å¤–å¹¶æ”¹ä¸ºä¸Šæ ‡ã€‚
        %
        % \if*#2*\else\NAT@cmt#2\fi
        \if\relax\NAT@date\relax\else\NAT@@close\fi
        \if*#2*\else\textsuperscript{#2}\fi
      \fi}{#1}{#2}}
  %
  % ä¸ºäº†å°†å‚è€ƒæ–‡çŒ®åŠ å…¥ç›®å½•å’Œ pdf ä¹¦ç­¾ï¼Œé‡æ–°å®šä¹‰ \pkg{natbib} çš„ \cmd{bibsection}
  % å¦å¤–å¦‚æœè°ƒç”¨äº† \pkg{chapterbib} æˆ–è€…ä½¿ç”¨äº† \opt{sectionbib} å‚æ•°ï¼Œ
  % éœ€è¦ä½¿ç”¨èŠ‚æ ‡é¢˜ \cs{section}ã€‚
  \newcommand\ustc@bib@chapter{%
    \@mainmatterfalse
    \chapter{\bibname}%
  }%
  \newcommand\ustc@bib@section{%
    \begingroup
      \ctexset{section/numbering=false}%
      \section{\bibname}%
    \endgroup
  }%
  \@ifpackagewith{chapterbib}{sectionbib}{%
    \ustc@error{The "sectionbib" option cannot be used with chaperbib if natbib loaded}%
  }{}%
  \@ifpackageloaded{chapterbib}{%
    \let\bibsection\ustc@bib@section
  }{%
    \@ifxundefined\NAT@sectionbib{%
      \let\bibsection\ustc@bib@chapter
    }{%
      \let\bibsection\ustc@bib@section
    }%
  }%
  %
  % å‚è€ƒæ–‡çŒ®åˆ—è¡¨æ ¼å¼ï¼šå®‹ä½“ 10.5 ç£…ï¼Œè¡Œè· 20 ç£…ï¼Œç»­è¡Œç¼©è¿›ä¸¤å­—ï¼Œå·¦å¯¹é½ã€‚
  % æœ¬ç§‘ç”Ÿä¾ç„¶æ˜¯å°å››å®‹ä½“ã€‚
  \renewcommand\bibfont{%
    \ifustc@degree@graduate
      \fontsize{10.5bp}{20bp}\selectfont
    \else
      \normalsize
    \fi
  }
  \setlength{\bibsep}{0\p@ \@plus.2\p@}
  \renewcommand\@biblabel[1]{[#1]\hfill}
  \setlength{\bibhang}{2\ccwd}
}


% biblatex å®åŒ…çš„é…ç½®

\AtEndOfPackageFile*{biblatex}{
  \DeclareRobustCommand\inlinecite{\parencite}
  \defbibheading{bibliography}[\bibname]{%
    \@mainmatterfalse
    \chapter{\bibname}%
  }
  \renewcommand\bibfont{%
    \ifustc@degree@graduate
      \fontsize{10.5bp}{20bp}\selectfont
    \else
      \normalsize
    \fi
  }
  \setlength{\bibitemsep}{0\p@ \@plus.2\p@}
  \setlength{\bibhang}{2\ccwd}
}

% \subsection{é™„å½•}

% å®šä¹‰äº†ä¸€ä¸ªæ»¡è¶³è¦æ±‚çš„è‡´è°¢ç¯å¢ƒï¼š
\newenvironment{acknowledgements}{%
  \@mainmatterfalse
  \ifustc@degree@graduate
    \chapter{\ustc@acknowledgements@name}%
  \else
    \ustc@chapter{\ustc@acknowledgements@name}%
    \ifustc@tocloaded
      æœ¬ç§‘ç”Ÿéœ€è¦æ‰‹åŠ¨å°†è‡´è°¢ç½®äºç›®å½•å‰ã€‚\par
    \fi
  \fi
}{}


% å…¼å®¹æ—§ç‰ˆæœ¬ä¸­â€œacknowledgmentsâ€çš„æ‹¼æ³•ã€‚
% Reserved for compatibility until 2020-07-01.
\newenvironment{acknowledgments}{%
  \begin{acknowledgements}%
}{%
  \end{acknowledgements}%
}

% å‘è¡¨æˆæœç¯å¢ƒï¼š
\newenvironment{publications}{%
  \@mainmatterfalse
  \chapter{\ustc@publication@name}%
}{}


% \subsection{å…¶ä»–å®åŒ…çš„è®¾ç½®}

% è¿™äº›å®åŒ…å¹¶éæ ¼å¼è¦æ±‚ï¼Œä½†æ˜¯ä¸ºäº†æ–¹ä¾¿åŒå­¦ä»¬ä½¿ç”¨ï¼Œåœ¨è¿™é‡Œè¿›è¡Œç®€å•è®¾ç½®ã€‚


% \subsubsection{\pkg{hyperref} å®åŒ…}

\AtEndOfPackageFile*{hyperref}{
  \hypersetup{
    bookmarksnumbered  = true,
    bookmarksopen      = true,
    bookmarksopenlevel = 1,
    linktoc            = all,
    unicode            = true,
    psdextra           = true,
  }
  %
  % å¦‚æœä¸º \opt{pdf} æ ·å¼ï¼Œè®¾ç½® hyperlink é¢œè‰²
  \ifustc@output@electronic
    \hypersetup{
      colorlinks = true,
      allcolors  = blue,
    }
  \else
    \hypersetup{hidelinks}
  \fi
  %
  % å¡«å†™ PDF å…ƒä¿¡æ¯ã€‚
  \AtBeginDocument{%
    \ifustc@main@language@chinese
      \hypersetup{
        pdftitle  = \ustc@title,
        pdfauthor = \ustc@author,
      }%
    \else
      \hypersetup{
        pdftitle  = \ustc@title@en,
        pdfauthor = \ustc@author@en,
      }%
    \fi
  }
  %
  % æ·»åŠ  PDF ä¹¦ç­¾
  %
  \newcounter{ustc@bookmarknumber}
  \renewcommand\ustc@pdfbookmark[1]{%
    \phantomsection
    \stepcounter{ustc@bookmarknumber}%
    \pdfbookmark[0]{#1}{ustcchapter.\theustc@bookmarknumber}%
  }
  %
  % åœ¨ PDF å­—ç¬¦ä¸²ä¸­å»æ‰æ¢è¡Œï¼Œä»¥å‡å°‘ \pkg{hyperref} çš„è­¦å‘Šä¿¡æ¯ã€‚
  \pdfstringdefDisableCommands{
    \let\\\@empty
    \let\hspace\@gobble
  }
  %
  % \pkg{hyperref} ä¸ \pkg{unicode-math} å­˜åœ¨ä¸€äº›å…¼å®¹æ€§é—®é¢˜ï¼Œè§
  % \href{https://github.com/ustctug/ustcthesis/issues/223}{%
  %   ustctug/ustcthesis\#223}ï¼Œ
  % \href{https://github.com/ho-tex/hyperref/pull/90}{ho-tex/hyperref\#90} å’Œ
  % \href{https://github.com/ustctug/ustcthesis/issues/235}{%
  %   ustctug/ustcthesis/\#235}ã€‚
  \@ifpackagelater{hyperref}{2019/04/27}{}{%
    \g@addto@macro\psdmapshortnames{\let\mu\textmu}%
  }
  %
  % è®¾ç½®ä¸­æ–‡çš„ \cs{autoref}ã€‚
  % \footnote{\url{https://tex.stackexchange.com/a/66150/82731}}
  \ifustc@language@chinese
    \def\equationautorefname~#1\null{å…¬å¼~(#1)\null}
    \def\footnoteautorefname{è„šæ³¨}
    \def\itemautorefname~#1\null{ç¬¬~#1~é¡¹\null}
    \def\figureautorefname{å›¾}
    \def\tableautorefname{è¡¨}
    \def\partautorefname~#1\null{ç¬¬~#1~éƒ¨åˆ†\null}
    \def\appendixautorefname{é™„å½•}
    \def\chapterautorefname~#1\null{ç¬¬~#1~ç« \null}
    \def\sectionautorefname~#1\null{ç¬¬~#1~èŠ‚\null}
    \def\subsectionautorefname~#1\null{ç¬¬~#1~å°èŠ‚\null}
    \def\subsubsectionautorefname~#1\null{ç¬¬~#1~å°å°èŠ‚\null}
    \def\paragraphautorefname~#1\null{ç¬¬~#1~æ®µ\null}
    \def\subparagraphautorefname~#1\null{ç¬¬~#1~å°æ®µ\null}
    \def\theoremautorefname{å®šç†}
    \def\HyRef@autopageref#1{\hyperref[{#1}]{ç¬¬~\pageref*{#1} é¡µ}}
  \fi
  %
  % æœ¬ç§‘ç”Ÿéœ€è¦åœ¨ \tableofcontents å¤„åˆ‡æ¢ \pagenumberingï¼Œ
  % åœ¨ä½¿ç”¨äº† notoccite åä¼šå¯¼è‡´ PDF ä¹¦ç­¾çš„é¡µç æœ‰è¯¯ï¼ˆ#293ï¼‰ï¼Œ
  % æ‰€ä»¥éœ€è¦è¡¥å…… https://tex.stackexchange.com/a/593839/82731 çš„ patchã€‚
  % LuaTeX ä¸éœ€è¦è¿™ä¸ª patchã€‚
  \ifXeTeX
    \def\HyPL@StorePageLabel#1{%
      \begingroup
        \edef\Hy@tempa{\the\Hy@abspage<<#1>>}%
        \immediate\write\@mainaux{%
          \string\HyPL@Entry{\Hy@tempa}%
        }%
      \endgroup
    }
  \fi
}


% \subsubsection{\pkg{amsthm} å®åŒ…}

\AtEndOfPackageFile*{amsthm}{
  \newtheoremstyle{ustcplain}
    {}{}
    {}{2\ccwd}
    {\bfseries}{}
    {\ccwd}{}
  \theoremstyle{ustcplain}
  % å®šä¹‰æ–°çš„å®šç†
  \ifustc@language@chinese
    \newcommand\ustc@assertion@name{æ–­è¨€}
    \newcommand\ustc@assumption@name{å‡è®¾}
    \newcommand\ustc@axiom@name{å…¬ç†}
    \newcommand\ustc@corollary@name{æ¨è®º}
    \newcommand\ustc@definition@name{å®šä¹‰}
    \newcommand\ustc@example@name{ä¾‹}
    \newcommand\ustc@lemma@name{å¼•ç†}
    \newcommand\ustc@proof@name{è¯æ˜}
    \newcommand\ustc@proposition@name{å‘½é¢˜}
    \newcommand\ustc@remark@name{æ³¨}
    \newcommand\ustc@theorem@name{å®šç†}
  \else
    \newcommand\ustc@assertion@name{Assertion}
    \newcommand\ustc@assumption@name{Assumption}
    \newcommand\ustc@axiom@name{Axiom}
    \newcommand\ustc@corollary@name{Corollary}
    \newcommand\ustc@definition@name{Definition}
    \newcommand\ustc@example@name{Example}
    \newcommand\ustc@lemma@name{Lemma}
    \newcommand\ustc@proof@name{Proof}
    \newcommand\ustc@proposition@name{Proposition}
    \newcommand\ustc@remark@name{Remark}
    \newcommand\ustc@theorem@name{Theorem}
  \fi
  \newtheorem{theorem}             {\ustc@theorem@name}    [chapter]
  \newtheorem{assertion}  [theorem]{\ustc@assertion@name}
  \newtheorem{axiom}      [theorem]{\ustc@axiom@name}
  \newtheorem{corollary}  [theorem]{\ustc@corollary@name}
  \newtheorem{lemma}      [theorem]{\ustc@lemma@name}
  \newtheorem{proposition}[theorem]{\ustc@proposition@name}
  \newtheorem{assumption}          {\ustc@assumption@name} [chapter]
  \newtheorem{definition}          {\ustc@definition@name} [chapter]
  \newtheorem{example}             {\ustc@example@name}    [chapter]
  \newtheorem*{remark}             {\ustc@remark@name}
  % \pkg{amsthm} å•ç‹¬å®šä¹‰äº† proof ç¯å¢ƒï¼Œè¿™é‡Œé‡æ–°å®šä¹‰ä»¥æ»¡è¶³æ ¼å¼è¦æ±‚ã€‚
  % åŸæœ¬æ¨¡ä»¿ \pkg{amsthm} å†™æˆ |\item[\hskip\labelsep\hskip2\ccwd #1\hskip\ccwd]|ï¼Œ
  % ä½†æ˜¯å´ä¼šå¤šå‡ºä¸€äº›é—´éš™ã€‚
  \renewenvironment{proof}[1][\ustc@proof@name]{\par
    \pushQED{\qed}%
    \normalfont \topsep6\p@\@plus6\p@\relax
    \trivlist
      \item\relax\hskip2\ccwd
      \textbf{#1}
      \hskip\ccwd\ignorespaces
    }{%
    \popQED\endtrivlist\@endpefalse
  }
  \renewcommand\qedsymbol{\ustc@qed}
}


% \subsubsection{\pkg{algorithm2e} å®åŒ…}

% æŒ‰ç« èŠ‚ç¼–å·ã€‚
\ifustc@degree@report\else
  \PassOptionsToPackage{algochapter}{algorithm2e}
\fi

\AtEndOfPackageFile*{algorithm2e}{
  \ifustc@language@chinese
    \SetAlgorithmName{ç®—æ³•}{ç®—æ³•}{ç®—æ³•æ¸…å•}
  \else
    \SetAlgorithmName{Algorithm}{Algorithm}{List of Algorithms}
  \fi
  %
  % è®¾ç½®ç®—æ³•ç¯å¢ƒçš„æ ¼å¼ã€‚
  \SetAlCapSkip{6bp}
  \SetAlCapFnt{\small}
  \SetAlCapNameFnt{\small}
  \ifustc@degree@graduate
    \SetAlCapNameSty{textbf}
  \fi
  \SetAlgoCaptionSeparator{\unskip\hspace*{\ccwd}}
  %
  % è®¾ç½®ç®—æ³•æ¸…å•çš„æ ¼å¼
  \renewcommand\listofalgocfs{%
    \ifustc@degree@graduate
      \cleardoublepage
    \fi
    \ustc@chapter{\listalgorithmcfname}%
    \@starttoc{loa}%
  }
  \titlecontents{algocf}
    [2.3em]{\normalsize}
    {\contentslabel{2.3em}}{}
    {\ustc@leaders\contentspage}
  \contentsuse{algocf}{loa}
}


% \subsubsection{\pkg{mathtools} å®åŒ…}

% \pkg{mathtools} ä¼šä¿®æ”¹ \pkg{unicode-math} çš„ `\underbrace` å’Œ `\overbrace`ï¼Œ
% éœ€è¦è¿˜åŸä¸º `\LaTeXunderbrace` å’Œ `\LaTeXoverbrace`ï¼Œ
% å‚è€ƒ \url{https://tex.stackexchange.com/q/521394/82731}ã€‚
\AtEndOfPackageFile*{mathtools}{
  \@ifpackageloaded{unicode-math}{
    \let\underbrace\LaTeXunderbrace
    \let\overbrace\LaTeXoverbrace
  }{}
}

% \subsubsection{\pkg{nomencl} å®åŒ…}

\AtEndOfPackageFile*{nomencl}{
  \let\nomname\ustc@notation@name
  \def\thenomenclature{%
    \ifustc@degree@graduate
      \cleardoublepage
      \pagestyle{headings}%
    \fi
    \ustc@chapter{\ustc@notation@name}%
    \nompreamble
    \list{}{%
      \labelwidth\nom@tempdim
      \leftmargin\labelwidth
      \advance\leftmargin\labelsep
      \itemsep\nomitemsep
      \let\makelabel\nomlabel}}
  \def\endthenomenclature{%
    \endlist
    \nompostamble
    \ifustc@degree@graduate
      \clearpage
      \pagestyle{plain}%
    \fi
  }
}


% \subsubsection{\pkg{siunitx} å®åŒ…}

\AtEndOfPackageFile*{siunitx}{
  \newcommand\ustc@set@siunitx@language{%
    \ifustc@language@chinese
      \sisetup{
        list-final-separator = { å’Œ },
        list-pair-separator  = { å’Œ },
        range-phrase         = {ï½},
      }%
    \else
      \sisetup{
        list-final-separator = {, and },
        list-pair-separator  = { and },
        range-phrase         = { to },
      }%
    \fi
  }
  \ustc@set@siunitx@language
  \ustc@option@hook{language}{\ustc@set@siunitx@language}
}

% \subsubsection{\pkg{chapterbib} å®åŒ…}

\AtEndOfPackageFile*{chapterbib}{
  \@ifpackageloaded{natbib}{%
    \@ifpackagewith{chapterbib}{sectionbib}{%
      \ustc@error{The "sectionbib" option cannot be used with chaperbib if natbib loaded}%
    }{}%
    \renewcommand\bibsection{%
      \begingroup
        \ctexset{section/numbering=false}%
        \section{\bibname}%
      \endgroup
    }
  }{}
}
